# node-red-contrib-conta-azul-api

![Conta Azul](https://user-images.githubusercontent.com/3945941/230798312-7f8f69a1-859e-4ff1-a371-1073ec0d49eb.svg)


This node enables you to work with the Conta Azul API, giving you the ability to set parameters through the Node-RED-UI and trigger the flow from within your existing flow.

It is based on [ ContaAzul API](https://developers.contaazul.com/).

## Usage

![Conta Azul](https://user-images.githubusercontent.com/3945941/230798311-d885e12e-a260-469d-9cbe-659868fb2cb7.svg)

### 1. Get the API-operations list

![Operations](https://user-images.githubusercontent.com/3945941/230801175-710c8190-39a4-4a2c-ba47-41a7f891e841.png?raw=true "Operations")

## 2. Understanding the API

Hovering on an operations title or a key, you see the respective comments within the mouseover. This allows you to understand what a parameter is meant for. Required parameters are marked with an asterisk.

![parameter description](https://user-images.githubusercontent.com/3945941/230797180-fb64adf4-8a39-4eea-9d3b-90eabe76fbcd.png?raw=true "Parameter description")

For JSON-parameters you can further show the structure by clicking on show keys. Again, the comments can be found within the mouseover.

![json description](https://user-images.githubusercontent.com/3945941/230797266-e5cea84b-4e14-432e-9724-a0874415f56c.png?raw=true "Json description")

## 3. Parameter configuration

Each parameter has an input-field corresponding to its type. You can further define that a parameter shall be read from the incoming message object or define a jsonata expression.

JSON parameters may define a sample structure. You can set this as the value by clicking the corresponding button - either with only the required keys (set required) or with all keys (set default).

## 4. Authentification

If the API requires an authentification token you can log in using the standard `http-request` node of Node-RED. The JWT token you get as a response must then be put into `msg.openApiToken` to be automatically placed in the request-header as bearer authentification.
In case you would like to use a different authentification than bearer, you can use `msg.headers` as you can do with the default http request node of Node-RED.

Both message object will be deleted afterwards if you do not set the option "Keep authentification".

## 5. Error handling

You can choose how to handle a returning server error. The last server response object will be placed in msg.response instead of msg.error. This ensures that all 3 ways react the same.

* `Standard`: The flow moves on normally. You have to handle an server error in your flow.
* `Separate output`: Your flow will take a different way.
* `Throw an exception`: Throws an node.error which can be catched by the standard 'catch' node (usefull for many nodes with the same error handling).

## Sample

![image](https://user-images.githubusercontent.com/3945941/230800038-8c1ca9d1-4d37-4397-86a5-63ab6a85f923.png)

```json
[{"id":"4097a5586d4dda60","type":"tab","label":"Conta Azul - ok ","disabled":false,"info":"","env":[]},{"id":"a5270bf39d2b1e5f","type":"tab","label":"Conta Azul","disabled":true,"info":"","env":[]},{"id":"ee01ea9dc7f8444d","type":"tab","label":"node-red-contrib-oauth2","disabled":false,"info":"","env":[]},{"id":"5c9759ef3159a97a","type":"tab","label":"Conta Azul","disabled":true,"info":"","env":[]},{"id":"487db9b6715b0e50","type":"tab","label":"Conta Azul API","disabled":false,"info":"","env":[]},{"id":"56ab15c9e767d058","type":"group","z":"a5270bf39d2b1e5f","name":"PRODUCTS","style":{"label":true},"nodes":["8eb6a30e696f032d","ad10637843808906"],"x":28,"y":693},{"id":"bbb8a32611c2c037","type":"group","z":"a5270bf39d2b1e5f","name":"AUTHENTICATION","style":{"label":true},"nodes":["466b68bd101cc969","7e1a2f9059f99060","3ce7547e36ce59f3"],"x":28,"y":33},{"id":"9d4745f75b37816d","type":"group","z":"a5270bf39d2b1e5f","name":"SALES","style":{"label":true},"nodes":["520c4afdd2a2c58c","d4955d968e26a214","fdb14db95ecc5489","3b12e437c83e0daf"],"x":28,"y":1173},{"id":"6096fe5c52cfd343","type":"group","z":"a5270bf39d2b1e5f","name":"CUSTOMERS","style":{"label":true},"nodes":["b43dde4d98c875f2","e94038d695093f33","af723a6dc70c8d0c","d437ac64422b7229","8ef7304f87a2b516","837c90f110656909","0649b31b191683d2","8aafeac1723a951f","e926df5e9fdd5f13","9bde48f6bc610288"],"x":34,"y":1919},{"id":"e90afc02c540d6bf","type":"group","z":"a5270bf39d2b1e5f","name":"OUTROS","style":{"label":true},"nodes":["8668d2144ef6f1c7","1d606b2c0278a39d","e507970da3ab090e","98b3bfc077fcc178","171b661d899461a7","8363ee16734aa229","00b57c33cfb11cbb","a562bd5b29300458","7fd9165a4da698af","9d8a234b6c840cec","f1b30d04c9b97d4a","72686b373891ff9a"],"x":34,"y":2099},{"id":"e61e769088c22705","type":"group","z":"ee01ea9dc7f8444d","name":"oauth2","style":{"fill":"#bfc7d7","label":true},"nodes":["dbf002e7839fdaf4","c11eb7aff843bd09"],"x":48,"y":33},{"id":"5d7d8563bb9c671c","type":"group","z":"5c9759ef3159a97a","name":"PRODUCTS","style":{"label":true},"nodes":["35588b75d7d50afa","3b9e704044803c6a"],"x":28,"y":593},{"id":"09abeff84581f2b0","type":"group","z":"5c9759ef3159a97a","name":"AUTHENTICATION","style":{"label":true},"nodes":["51404f5021ed7fca","bd07876c8e425d9d","f1dbdf37623a6927"],"x":28,"y":-7},{"id":"cf0e3e7e93bc7115","type":"group","z":"5c9759ef3159a97a","name":"SALES","style":{"label":true},"nodes":["99fae81d7a094d03","a8ac9c83a7b77bf0","7a261fa71959f9de","ea8a0fa9679b81d2"],"x":28,"y":1073},{"id":"41aa784187311a07","type":"group","z":"5c9759ef3159a97a","name":"CUSTOMERS","style":{"label":true},"nodes":["5461287b8732fb07","340a1eace5a4e4e2","bad94711051ba5e3","9391f1454c274c40","5f619e3680f763af","f7d87502783b12ca","2e415f8420c1a579","7857032bb2b21f4e","690f9621cd962e9d","70651ac9c17f487e"],"x":34,"y":1899},{"id":"2b3d518cab3c19a8","type":"group","z":"5c9759ef3159a97a","name":"OUTROS","style":{"label":true},"nodes":["7c718a1f2929762b","1cbf3a9ed6c20988","e66b94590d2247cd","9f23868617c4734a","151247aeb12dbd79","ac81aad291b9dfa5","9cf710228a5b5188","cf318bc7530bdf7c","2894df20c5f31f08","2a3ffad572ec0b9f","6eeba9f7935a61c9","7d509b300234fb53"],"x":34,"y":2099},{"id":"298beb7ebcb066d5","type":"group","z":"4097a5586d4dda60","name":"","style":{"fill":"#bfdbef","label":true},"nodes":["ee86852f62926632","9e4d3edfde1766b9","d7a2041ef2683870","d6a9acbdde790ed4","eaaf489faf9be82d","f7023ea98340c106","57a6983712ca1655"],"x":34,"y":39,"w":952,"h":162},{"id":"80c2477b787586ba","type":"group","z":"4097a5586d4dda60","name":"Authorization Code","style":{"label":true,"fill":"#3f93cf","color":"#ffffff"},"nodes":["7853c7bdf38ec28a","2772d9256a7dc4e8","5b3f92d375e7d3a2","6585de41e271987b"],"x":14,"y":559,"w":1212,"h":82},{"id":"8eb6a30e696f032d","type":"group","z":"a5270bf39d2b1e5f","g":"56ab15c9e767d058","name":"PRODUCT CATEGORIES","style":{"label":true},"nodes":["4642b89e9222ba63","305f5fe9e6c555a9","af6082a695d10792","523bdef02e031da3","690fdab22117e084","04393361ea052f4e","8859ca37fde68cd8","6e99bacf77e40947","2c35938c1ab9765d"],"x":54,"y":719},{"id":"ad10637843808906","type":"group","z":"a5270bf39d2b1e5f","g":"56ab15c9e767d058","name":"PRODUCTS LIST","style":{"label":true},"nodes":["859a498192a464e6","7f682d4dd3a7350e","a9f089bb889079ba","cf6a8a293a3416f0","8632dc1f7cae2e36","96f25beefd9f4ad8","2b4d93a7377daeb3","4b96b4f4e88fa774","6d1cc2dfd3f1a263","2456fb26facc2e13"],"x":54,"y":919},{"id":"466b68bd101cc969","type":"group","z":"a5270bf39d2b1e5f","g":"bbb8a32611c2c037","name":"CREDENTIALS","style":{"label":true},"nodes":["8c67ec731a3c9cad","406b0a21329cf8d1","27e0ffbe491ea8f5","ceee711fb518653f","d820ad4eae640b0c","10d7fda56335549d"],"x":54,"y":59},{"id":"7e1a2f9059f99060","type":"group","z":"a5270bf39d2b1e5f","g":"bbb8a32611c2c037","name":"REFRESH","style":{"label":true,"stroke":"#0070c0","color":"#000000","fill":"#7fb7df"},"nodes":["d1ba341040cea0c3","aa24d69faa1640cd","efd1a2a910ca1051","a8fca004e704e071","9e9332c792dbdc01","4030c52c.c2c29c","31727a2c.05a026","64d9243f.b7be7c","3b67977c.a53c08"],"x":54,"y":199},{"id":"3ce7547e36ce59f3","type":"group","z":"a5270bf39d2b1e5f","g":"bbb8a32611c2c037","name":"TOKEN","style":{"label":true},"nodes":["c3a4a71d41598827","1809fd1bf70e37c1","4127bb1788d9d2ac","c3df22dd001e6edf","415fb04725a88f1f","1e3bb891e03d3d9a","361f24fcab9e4941","5b03b7211002b51c","7cbc36987152bf6d"],"x":54,"y":379},{"id":"520c4afdd2a2c58c","type":"group","z":"a5270bf39d2b1e5f","g":"9d4745f75b37816d","name":"LIST SALES","style":{"label":true},"nodes":["bb85a7678e125257","dbc564b793ab2147","559f581f0b47ea55","7c80bb99fb8dd6cf","9e853932e5246287","85400eee0244b9bf","288faaaba62e9a21","42652ca971069b48","7bdb4f61e6364d06","09f28a6bb15a86f2","aa7d344c640480bd","e2c59302d572a28d","db8917699fd33413"],"x":54,"y":1199},{"id":"d4955d968e26a214","type":"group","z":"a5270bf39d2b1e5f","g":"9d4745f75b37816d","name":"LIST SALES ITEMS","style":{"label":true},"nodes":["b6a3304892da3876","8394a30dc9e26b4a","38ba0d7fa969840f","71b447e4ec057c50","e5b6127830cd9203","e68697b67f6f0aa1","44f4dc20024c4528","3576871ba80bd4c5","ac1058c7e9d5117f","7f14a77456407be8"],"x":54,"y":1399},{"id":"fdb14db95ecc5489","type":"group","z":"a5270bf39d2b1e5f","g":"9d4745f75b37816d","name":"GET SALE","style":{"label":true},"nodes":["ec24e2f9a38a9c56","3dfc0881926e24b1","9dc031fb3dd47809","ccc79a9b87589a0d","56d7c30edea5a455","d88f4d039f040eac","6db64c6ff1f76750","6497d0e79437e766"],"x":54,"y":1559},{"id":"3b12e437c83e0daf","type":"group","z":"a5270bf39d2b1e5f","g":"9d4745f75b37816d","name":"GET SALES TOTAIS","style":{"label":true},"nodes":["f725e856f8536fa5","af4549b50d1d821d","bf22b8e71c4d831a","e431d47ac20af172","05e86e4e8d3d1d2e","72ea348eb03bafbb","1cf8e60b301c5103","5c8d657e91f0bf57","40265c08de68bbd9","36617a0d11f502d9"],"x":54,"y":1699},{"id":"dbf002e7839fdaf4","type":"group","z":"ee01ea9dc7f8444d","g":"e61e769088c22705","name":"by msg.oauth2Request","style":{"label":true,"fill":"#bfdbef"},"nodes":["bbb398a4c6b6581d","0dbd3192fc8e6d8f","7d1cd69bfec40f16","5f5889fc9873830c","5eedef6eb8215636","1f9670457ea0fdeb","e92113c4c92e02b9","6adbb00a164f0d30","aa78cee9cf6b05a4","da4c05becf924c6a","00bcb23670663c56"],"x":74,"y":219},{"id":"c11eb7aff843bd09","type":"group","z":"ee01ea9dc7f8444d","g":"e61e769088c22705","name":"by node","style":{"label":true,"fill":"#e3f3d3"},"nodes":["fa297a2263ccab64","b09fcda36b29337e","68ce0e033979d11d","92a15df57cfde3ad","be9f8d3e5126b0aa","457c466345b3c830","41140191adba1afc"],"x":74,"y":59},{"id":"35588b75d7d50afa","type":"group","z":"5c9759ef3159a97a","g":"5d7d8563bb9c671c","name":"PRODUCT CATEGORIES","style":{"label":true},"nodes":["1dcf1dfdf1af4aa2","4b95cdba611c7ecc","22fc844e4abc01ef","19a4cabc78515277","961a51c12ae3005f","07703155e48b860d","d2f55a4a34d1fc76","cbeb25d8c2fb3866","e9dc48db000bfe67"],"x":54,"y":619},{"id":"3b9e704044803c6a","type":"group","z":"5c9759ef3159a97a","g":"5d7d8563bb9c671c","name":"PRODUCTS LIST","style":{"label":true},"nodes":["88ca1d0a07edc082","bd7baf5218eb49f8","b1371c0ff1bfdee4","8b012fb4ed07cea3","728dcd9a98ae0381","ea4d233de31bcc0d","3667c87482f6b13c","5929942a20b21e97","6549481bf4a5f244","7411304d57de6ad2"],"x":54,"y":819},{"id":"51404f5021ed7fca","type":"group","z":"5c9759ef3159a97a","g":"09abeff84581f2b0","name":"CREDENTIALS","style":{"label":true},"nodes":["2e5abb9821a329c6","3b4f8e8b37bd7b95","894dc2ef962f6a0c","04911ba0231eee37","55f197ed00ab8cef","8105c17d77dcf7e7"],"x":54,"y":19},{"id":"bd07876c8e425d9d","type":"group","z":"5c9759ef3159a97a","g":"09abeff84581f2b0","name":"REFRESH","style":{"label":true},"nodes":["91436a6d7b36eb04","a56d3f31e9e72b71","d4ad2e5511305738","979cb5cc50bd910e","41867e59d52a4194"],"x":54,"y":179},{"id":"f1dbdf37623a6927","type":"group","z":"5c9759ef3159a97a","g":"09abeff84581f2b0","name":"TOKEN","style":{"label":true},"nodes":["b247935249683177","35cc77879440c98c","aaff5253f1fade5b","6b8b1a021eed6da5","c14b14bebd07ec44","e8a495a3b5df0ca4","96eb5d6d55ee0977","d05028084a3d104a","fed0f6203cbff7dd"],"x":54,"y":279},{"id":"99fae81d7a094d03","type":"group","z":"5c9759ef3159a97a","g":"cf0e3e7e93bc7115","name":"LIST SALES","style":{"label":true},"nodes":["c7d6de386335dc90","f9fa3a590217202e","050e2e72ba37fc78","8ed74c2f06e92c4e","9739957ad5885163","3092da4bd85a147d","e0bb1fa57aff0d1d","23255cdefad65576","f5b1c680f82c4ee6","d4741f4f29552e23","35d736e805bee757","2f2bfe9eacc38c83","d815e97ec30e2840"],"x":54,"y":1099},{"id":"a8ac9c83a7b77bf0","type":"group","z":"5c9759ef3159a97a","g":"cf0e3e7e93bc7115","name":"LIST SALES ITEMS","style":{"label":true},"nodes":["8a181a7c94f10639","c316e349cd742259","06c2e22ef01b56df","da58e4a719dd7334","7d6588d955f2d3d8","09fbd32cd28448d0","7220291f1f854695","15f7895c5704f726","a2c763f2768a2cf0","82c2ca737c66f4c1"],"x":54,"y":1299},{"id":"7a261fa71959f9de","type":"group","z":"5c9759ef3159a97a","g":"cf0e3e7e93bc7115","name":"GET SALE","style":{"label":true},"nodes":["fde5fd829b827d3b","fea10929382cdf5b","ec2e39922e42fd55","06da29a6553dc345","4f65ce046ea15683","2ed1581d96c9c313","62cdf19d62ebb032","192fcb289ca9f3bf"],"x":54,"y":1459},{"id":"ea8a0fa9679b81d2","type":"group","z":"5c9759ef3159a97a","g":"cf0e3e7e93bc7115","name":"GET SALES TOTAIS","style":{"label":true},"nodes":["22ce6f6bd61b88d7","36fdb7968167bc14","fa9c8e28505c82a9","58d49901950d08f6","a6495e2c7558b8c2","62a3d2117b39ee68","eb5b0d016a514a87","b5ef4d8767a8ce52","035b26e486df209c","f5c0c9efd0efeaca"],"x":54,"y":1599},{"id":"9b8802ac7671fc6a","type":"group","z":"487db9b6715b0e50","name":"","style":{"fill":"#bfdbef","label":true},"nodes":["2b2fa87a3ebdd2b9","a2d2d1b9d446f1a8","7925e8f35166a321","657f72e1082f3e16","90b407562de16c0f","c4e0873c88c773bc","82b6e134785ca7de"],"x":34,"y":39,"w":952,"h":162},{"id":"be5d452d428a194f","type":"group","z":"4097a5586d4dda60","name":"","style":{"fill":"#bfdbef","label":true},"nodes":["36055b5cbaa83eaa","f81430aef68a27e5","41a276ae36ef4aea","ea9c7051e2e62840","ed68c66545ead2cc","c896c6dd9edd1318","c715ecc8a8a02796"],"x":34,"y":219,"w":952,"h":162},{"id":"7d1cd69bfec40f16","type":"junction","z":"ee01ea9dc7f8444d","g":"dbf002e7839fdaf4","x":880,"y":280,"wires":[[]]},{"id":"92a15df57cfde3ad","type":"junction","z":"ee01ea9dc7f8444d","g":"c11eb7aff843bd09","x":860,"y":120,"wires":[["41140191adba1afc"]]},{"id":"0dbd3192fc8e6d8f","type":"junction","z":"ee01ea9dc7f8444d","g":"dbf002e7839fdaf4","x":560,"y":300,"wires":[["bbb398a4c6b6581d"]]},{"id":"f131e02fdc178416","type":"gauth","name":"xxx@xxx"},{"id":"ee86852f62926632","type":"oauth2","z":"4097a5586d4dda60","g":"298beb7ebcb066d5","name":"OAuth2 - Conta Azul","container":"oauth2Response","grant_type":"authorization_code","access_token_url":" https://api.contaazul.com/oauth2/token","authorization_endpoint":"https://api.contaazul.com/auth/authorize","redirect_uri":"/oauth2/redirect_uri","open_authentication":"","username":"","password":"","client_id":"QwkQtN5hQVHWVfpJDr7J1pamiWjvFDeo","client_secret":"Sra1MkjDU18SdsO5GTOz6hlTnMvthWM0","scope":"Product","proxy":"","senderr":false,"client_credentials_in_body":false,"rejectUnauthorized":false,"headers":{},"x":340,"y":80,"wires":[["d6a9acbdde790ed4"]]},{"id":"9e4d3edfde1766b9","type":"inject","z":"4097a5586d4dda60","g":"298beb7ebcb066d5","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":80,"wires":[["ee86852f62926632"]]},{"id":"d7a2041ef2683870","type":"debug","z":"4097a5586d4dda60","g":"298beb7ebcb066d5","name":"debug","active":true,"tosidebar":true,"console":true,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":880,"y":120,"wires":[]},{"id":"d6a9acbdde790ed4","type":"function","z":"4097a5586d4dda60","g":"298beb7ebcb066d5","name":"set ACCESS_TOKEN","func":"global.set('ACCESS_TOKEN', msg.oauth2Response.access_token);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":660,"y":80,"wires":[["d7a2041ef2683870"]]},{"id":"eaaf489faf9be82d","type":"inject","z":"4097a5586d4dda60","g":"298beb7ebcb066d5","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":160,"wires":[["f7023ea98340c106"]]},{"id":"f7023ea98340c106","type":"function","z":"4097a5586d4dda60","g":"298beb7ebcb066d5","name":"get ACCESS_TOKEN","func":"msg.openApiToken = `${global.get('ACCESS_TOKEN')}`;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":160,"wires":[["57a6983712ca1655"]]},{"id":"7853c7bdf38ec28a","type":"function","z":"4097a5586d4dda60","g":"80c2477b787586ba","name":"Set refreshToken","func":"if (msg.oauth2Response.refresh_token) {\n    global.set('refreshToken', msg.oauth2Response.refresh_token);\n}\nif (msg.oauth2Response.access_token) {\n    global.set('accessToken', msg.oauth2Response.access_token);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":930,"y":600,"wires":[["5b3f92d375e7d3a2"]]},{"id":"2772d9256a7dc4e8","type":"oauth2","z":"4097a5586d4dda60","g":"80c2477b787586ba","name":"Authorization Code","container":"oauth2Response","grant_type":"authorization_code","access_token_url":"https://ticktick.com/oauth/token","authorization_endpoint":"https://ticktick.com/oauth/authorize","redirect_uri":"/oauth2/redirect_uri","open_authentication":"USj6qd","username":"","password":"","client_id":"c2LNSOp0kH7aqL32YZ","client_secret":"L7WI0r@^sI*4g_bbP3A5U7r*!1(hk+u%","scope":"tasks:write tasks:read","proxy":"","senderr":false,"client_credentials_in_body":true,"rejectUnauthorized":true,"headers":{},"x":390,"y":600,"wires":[["7853c7bdf38ec28a"]]},{"id":"5b3f92d375e7d3a2","type":"debug","z":"4097a5586d4dda60","g":"80c2477b787586ba","name":"DBG 1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1130,"y":600,"wires":[]},{"id":"6585de41e271987b","type":"inject","z":"4097a5586d4dda60","g":"80c2477b787586ba","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":600,"wires":[["2772d9256a7dc4e8"]]},{"id":"57a6983712ca1655","type":"conta-azul","z":"4097a5586d4dda60","g":"298beb7ebcb066d5","name":"","api":"Product","server":"","keepAuth":false,"alternServer":false,"operation":"list1","operationData":{"tags":["Product"],"summary":"List product categories","description":"","operationId":"list1","produces":["application/json"],"parameters":[{"name":"name","in":"query","description":"The name of the product category","required":false,"type":"string"},{"name":"page","in":"query","description":"The page of the list to be returned","required":false,"type":"string"},{"name":"size","in":"query","description":"The quantity of items in the page to be returned","required":false,"type":"string"}],"responses":{"200":{"description":"Product Categories found with the specified parameters","schema":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string","format":"uuid","example":"c7288c09-829d-48b9-aee2-4f744e380587","description":"The id of the product's category"},"name":{"type":"string","example":"Kitchen utensils","description":"The name of the product's category"}},"description":"A category that can be applied to a product","$$ref":"https://api.contaazul.com/schema#/definitions/ProductCategory"}}},"400":{"description":"Invalid search parameters. The possible reasons are : <ul><li>A invalid search parameter was provided</li><li>No search parameters were provided</li></ul>"},"401":{"description":"Unauthorized token - it may be due to an invalid token or no token provided"}},"__originalOperationId":"list","path":"/v1/product-categories"},"errorHandling":"Standard","internalErrors":{"readUrl":false},"parameters":[{"id":"namequery","name":"name","in":"query","required":false,"value":"","isActive":false,"type":"str","allowedTypes":["str","json","jsonata","msg","flow","global"],"description":"The name of the product category","schema":null,"keys":null,"showDescription":false},{"id":"pagequery","name":"page","in":"query","required":false,"value":"","isActive":false,"type":"str","allowedTypes":["str","json","jsonata","msg","flow","global"],"description":"The page of the list to be returned","schema":null,"keys":null,"showDescription":false},{"id":"sizequery","name":"size","in":"query","required":false,"value":"","isActive":false,"type":"str","allowedTypes":["str","json","jsonata","msg","flow","global"],"description":"The quantity of items in the page to be returned","schema":null,"keys":null,"showDescription":false}],"requestContentType":"application/json","responseContentType":"","showDescription":true,"devMode":false,"outputs":1,"x":610,"y":160,"wires":[["d7a2041ef2683870"]]},{"id":"36055b5cbaa83eaa","type":"oauth2","z":"4097a5586d4dda60","g":"be5d452d428a194f","name":"OAuth2 - Conta Azul","container":"oauth2Response","grant_type":"authorization_code","access_token_url":" https://api.contaazul.com/oauth2/token","authorization_endpoint":"https://api.contaazul.com/auth/authorize","redirect_uri":"/oauth2/redirect_uri","open_authentication":"FiKnN7E7eSesMm7QmYQRDCOKHaWy4igr","username":"","password":"","client_id":"QwkQtN5hQVHWVfpJDr7J1pamiWjvFDeo","client_secret":"Sra1MkjDU18SdsO5GTOz6hlTnMvthWM0","scope":"Product","proxy":"","senderr":false,"client_credentials_in_body":false,"rejectUnauthorized":false,"headers":{},"x":340,"y":260,"wires":[["ea9c7051e2e62840"]]},{"id":"f81430aef68a27e5","type":"inject","z":"4097a5586d4dda60","g":"be5d452d428a194f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":260,"wires":[["36055b5cbaa83eaa"]]},{"id":"41a276ae36ef4aea","type":"debug","z":"4097a5586d4dda60","g":"be5d452d428a194f","name":"debug","active":true,"tosidebar":true,"console":true,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":880,"y":300,"wires":[]},{"id":"ea9c7051e2e62840","type":"function","z":"4097a5586d4dda60","g":"be5d452d428a194f","name":"set ACCESS_TOKEN","func":"global.set('ACCESS_TOKEN', msg.oauth2Response.access_token);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":660,"y":260,"wires":[["41a276ae36ef4aea"]]},{"id":"ed68c66545ead2cc","type":"inject","z":"4097a5586d4dda60","g":"be5d452d428a194f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":340,"wires":[["c715ecc8a8a02796"]]},{"id":"c896c6dd9edd1318","type":"conta-azul","z":"4097a5586d4dda60","g":"be5d452d428a194f","name":"","api":"Product","server":"","keepAuth":false,"alternServer":false,"operation":"list1","operationData":{"tags":["Product"],"summary":"List product categories","description":"","operationId":"list1","produces":["application/json"],"parameters":[{"name":"name","in":"query","description":"The name of the product category","required":false,"type":"string"},{"name":"page","in":"query","description":"The page of the list to be returned","required":false,"type":"string"},{"name":"size","in":"query","description":"The quantity of items in the page to be returned","required":false,"type":"string"}],"responses":{"200":{"description":"Product Categories found with the specified parameters","schema":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string","format":"uuid","example":"c7288c09-829d-48b9-aee2-4f744e380587","description":"The id of the product's category"},"name":{"type":"string","example":"Kitchen utensils","description":"The name of the product's category"}},"description":"A category that can be applied to a product","$$ref":"https://api.contaazul.com/schema#/definitions/ProductCategory"}}},"400":{"description":"Invalid search parameters. The possible reasons are : <ul><li>A invalid search parameter was provided</li><li>No search parameters were provided</li></ul>"},"401":{"description":"Unauthorized token - it may be due to an invalid token or no token provided"}},"__originalOperationId":"list","path":"/v1/product-categories"},"errorHandling":"Standard","internalErrors":{"readUrl":false},"parameters":[{"id":"namequery","name":"name","in":"query","required":false,"value":"","isActive":false,"type":"str","allowedTypes":["str","json","jsonata","msg","flow","global"],"description":"The name of the product category","schema":null,"keys":null,"showDescription":false},{"id":"pagequery","name":"page","in":"query","required":false,"value":"","isActive":false,"type":"str","allowedTypes":["str","json","jsonata","msg","flow","global"],"description":"The page of the list to be returned","schema":null,"keys":null,"showDescription":false},{"id":"sizequery","name":"size","in":"query","required":false,"value":"","isActive":false,"type":"str","allowedTypes":["str","json","jsonata","msg","flow","global"],"description":"The quantity of items in the page to be returned","schema":null,"keys":null,"showDescription":false}],"requestContentType":"application/json","responseContentType":"","showDescription":true,"devMode":false,"outputs":1,"x":610,"y":340,"wires":[["41a276ae36ef4aea"]]},{"id":"c715ecc8a8a02796","type":"function","z":"4097a5586d4dda60","g":"be5d452d428a194f","name":"get ACCESS_TOKEN","func":"msg.openApiToken = global.get('ACCESS_TOKEN');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":340,"wires":[["c896c6dd9edd1318"]]},{"id":"8c67ec731a3c9cad","type":"debug","z":"a5270bf39d2b1e5f","g":"466b68bd101cc969","name":"Set Global Token","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":810,"y":100,"wires":[]},{"id":"406b0a21329cf8d1","type":"oauth2","z":"a5270bf39d2b1e5f","g":"466b68bd101cc969","name":"Client Credentials","container":"oauth2Response","grant_type":"authorization_code","access_token_url":"https://api.contaazul.com/oauth2/token","authorization_endpoint":"https://api.contaazul.com/auth/authorize","open_authentication":"","username":"lcaloi","password":"","client_id":"client_id","client_secret":"client_secret","scope":"sales","client_credentials_in_body":true,"rejectUnauthorized":true,"headers":{},"x":390,"y":100,"wires":[["ceee711fb518653f","d820ad4eae640b0c"]]},{"id":"27e0ffbe491ea8f5","type":"inject","z":"a5270bf39d2b1e5f","g":"466b68bd101cc969","name":"Client Credentials","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":190,"y":120,"wires":[["10d7fda56335549d"]]},{"id":"4642b89e9222ba63","type":"http request","z":"a5270bf39d2b1e5f","g":"8eb6a30e696f032d","name":"List product categories","method":"GET","ret":"obj","paytoqs":"query","url":"https://api.contaazul.com/v1/product-categories","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":590,"y":820,"wires":[["2c35938c1ab9765d"]]},{"id":"ceee711fb518653f","type":"function","z":"a5270bf39d2b1e5f","g":"466b68bd101cc969","name":"Set Global Token","func":"global.set('refreshToken', msg.oauth2Response.refresh_token);\nglobal.set('accessToken', msg.oauth2Response.access_token);\nglobal.set('tokenType', msg.oauth2Response.token_type);\nglobal.set('expiresIn', msg.oauth2Response.expires_in);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":610,"y":100,"wires":[["8c67ec731a3c9cad"]]},{"id":"305f5fe9e6c555a9","type":"function","z":"a5270bf39d2b1e5f","g":"8eb6a30e696f032d","name":"Authorization","func":"let accessToken = global.get('accessToken');\n\nmsg.headers = {};\n//msg.headers['Authorization'] = 'Bearer XXXX';\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":390,"y":820,"wires":[["4642b89e9222ba63"]]},{"id":"af6082a695d10792","type":"inject","z":"a5270bf39d2b1e5f","g":"8eb6a30e696f032d","name":"List product categories","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"List product categories","x":200,"y":820,"wires":[["305f5fe9e6c555a9"]]},{"id":"859a498192a464e6","type":"http request","z":"a5270bf39d2b1e5f","g":"ad10637843808906","name":"List products by filters","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://api.contaazul.com/v1/products?size=999","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":580,"y":1000,"wires":[["6d1cc2dfd3f1a263"]]},{"id":"bb85a7678e125257","type":"http request","z":"a5270bf39d2b1e5f","g":"520c4afdd2a2c58c","name":"List sales by filters","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://api.contaazul.com/v1/sales?emission_start=2023-03-27&emission_end=2023-03-27","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":590,"y":1280,"wires":[["288faaaba62e9a21"]]},{"id":"8668d2144ef6f1c7","type":"http request","z":"a5270bf39d2b1e5f","g":"e90afc02c540d6bf","name":"List sellers","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://api.contaazul.com/v1/sales/sellers","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":550,"y":2200,"wires":[["1d606b2c0278a39d"]]},{"id":"d1ba341040cea0c3","type":"inject","z":"a5270bf39d2b1e5f","g":"7e1a2f9059f99060","name":"Refresh Token","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3300","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":240,"wires":[["aa24d69faa1640cd"]]},{"id":"aa24d69faa1640cd","type":"function","z":"a5270bf39d2b1e5f","g":"7e1a2f9059f99060","name":"Refresh Token","func":"let refreshToken = global.get('refreshToken');\n\nmsg.oauth2Request = { \n    \"access_token_url\": \"https://api.contaazul.com/oauth2/token\",\n    \"credentials\": {\n        \"grant_type\": \"refresh_token\",\n        \"client_id\": \"pDcX0lJRsUfWovh5kAOHdILX8W53bcnE\",\n        \"client_secret\": \"tcRJQdy2s9bKoJAFJRSJh6ycHuBY2emo\",\n        \"scope\": \"sales\",\n        \"refresh_token\": refreshToken   \n    },\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":240,"wires":[["efd1a2a910ca1051"]]},{"id":"efd1a2a910ca1051","type":"oauth2","z":"a5270bf39d2b1e5f","g":"7e1a2f9059f99060","name":"Set by msg.oauth2Request","container":"oauth2Response","grant_type":"set_by_credentials","access_token_url":"http://localhost:3000/oauth/token ","username":"pedroet","password":"","client_id":"confidentialApplication","client_secret":"topSecret","scope":"*","headers":{},"x":660,"y":240,"wires":[["a8fca004e704e071"]]},{"id":"a8fca004e704e071","type":"function","z":"a5270bf39d2b1e5f","g":"7e1a2f9059f99060","name":"Set refreshToken","func":"if (msg.oauth2Response.refreshToken) {\n    global.set('refreshToken',msg.oauth2Response.refreshToken);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":890,"y":240,"wires":[["9e9332c792dbdc01"]]},{"id":"9e9332c792dbdc01","type":"debug","z":"a5270bf39d2b1e5f","g":"7e1a2f9059f99060","name":"Refresh Token","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1080,"y":240,"wires":[]},{"id":"d820ad4eae640b0c","type":"debug","z":"a5270bf39d2b1e5f","g":"466b68bd101cc969","name":"Client Credentials","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":610,"y":140,"wires":[]},{"id":"1d606b2c0278a39d","type":"debug","z":"a5270bf39d2b1e5f","g":"e90afc02c540d6bf","name":"List sellers","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":830,"y":2200,"wires":[]},{"id":"dbc564b793ab2147","type":"debug","z":"a5270bf39d2b1e5f","g":"520c4afdd2a2c58c","name":"List sales by filters","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1350,"y":1300,"wires":[]},{"id":"7f682d4dd3a7350e","type":"debug","z":"a5270bf39d2b1e5f","g":"ad10637843808906","name":"List products by filters (otherwise)","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1060,"y":1080,"wires":[]},{"id":"523bdef02e031da3","type":"debug","z":"a5270bf39d2b1e5f","g":"8eb6a30e696f032d","name":"List product categories","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1030,"y":820,"wires":[]},{"id":"b6a3304892da3876","type":"debug","z":"a5270bf39d2b1e5f","g":"d4955d968e26a214","name":"sales-items","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1390,"y":1500,"wires":[]},{"id":"8394a30dc9e26b4a","type":"function","z":"a5270bf39d2b1e5f","g":"d4955d968e26a214","name":"List sale items by filters","func":"let id = msg.payload.id;\nlet accessToken = global.get('accessToken');\n\nmsg.headers = {};\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\nmsg.url = \"https://api.contaazul.com/v1/sales/\" + id + \"/items\";\nmsg.contaazul = id;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":670,"y":1480,"wires":[["38ba0d7fa969840f"]]},{"id":"559f581f0b47ea55","type":"split","z":"a5270bf39d2b1e5f","g":"520c4afdd2a2c58c","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":990,"y":1240,"wires":[["85400eee0244b9bf"]]},{"id":"c3a4a71d41598827","type":"change","z":"a5270bf39d2b1e5f","g":"3ce7547e36ce59f3","name":"accessToken","rules":[{"t":"set","p":"payload","pt":"msg","to":"accessToken","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":420,"wires":[["1809fd1bf70e37c1"]]},{"id":"1809fd1bf70e37c1","type":"debug","z":"a5270bf39d2b1e5f","g":"3ce7547e36ce59f3","name":"accessToken","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":670,"y":420,"wires":[]},{"id":"4127bb1788d9d2ac","type":"inject","z":"a5270bf39d2b1e5f","g":"3ce7547e36ce59f3","name":"Valida Variaveis Globais","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":200,"y":500,"wires":[["c3a4a71d41598827","c3df22dd001e6edf","1e3bb891e03d3d9a","5b03b7211002b51c"]]},{"id":"c3df22dd001e6edf","type":"change","z":"a5270bf39d2b1e5f","g":"3ce7547e36ce59f3","name":"refreshToken","rules":[{"t":"set","p":"payload","pt":"msg","to":"refreshToken","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":480,"wires":[["415fb04725a88f1f"]]},{"id":"415fb04725a88f1f","type":"debug","z":"a5270bf39d2b1e5f","g":"3ce7547e36ce59f3","name":"refreshToken","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":670,"y":480,"wires":[]},{"id":"1e3bb891e03d3d9a","type":"change","z":"a5270bf39d2b1e5f","g":"3ce7547e36ce59f3","name":"tokenType","rules":[{"t":"set","p":"payload","pt":"msg","to":"tokenType","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":540,"wires":[["361f24fcab9e4941"]]},{"id":"361f24fcab9e4941","type":"debug","z":"a5270bf39d2b1e5f","g":"3ce7547e36ce59f3","name":"tokenType","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":670,"y":540,"wires":[]},{"id":"5b03b7211002b51c","type":"change","z":"a5270bf39d2b1e5f","g":"3ce7547e36ce59f3","name":"expiresIn","rules":[{"t":"set","p":"payload","pt":"msg","to":"expiresIn","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":600,"wires":[["7cbc36987152bf6d"]]},{"id":"7cbc36987152bf6d","type":"debug","z":"a5270bf39d2b1e5f","g":"3ce7547e36ce59f3","name":"expiresIn","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":660,"y":600,"wires":[]},{"id":"38ba0d7fa969840f","type":"http request","z":"a5270bf39d2b1e5f","g":"d4955d968e26a214","name":"msg.url","method":"GET","ret":"obj","paytoqs":"query","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":860,"y":1480,"wires":[["e68697b67f6f0aa1"]]},{"id":"ec24e2f9a38a9c56","type":"function","z":"a5270bf39d2b1e5f","g":"fdb14db95ecc5489","name":"Get sale by id","func":"let id = msg.payload.id;\nlet accessToken = global.get('accessToken');\n\nmsg.headers = {};\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\nmsg.url = \"https://api.contaazul.com/v1/sales/\" + id;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":560,"y":1620,"wires":[["ccc79a9b87589a0d"]]},{"id":"e507970da3ab090e","type":"http request","z":"a5270bf39d2b1e5f","g":"e90afc02c540d6bf","name":"List services by filters","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://api.contaazul.com/v1/services","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":580,"y":2140,"wires":[["98b3bfc077fcc178"]]},{"id":"98b3bfc077fcc178","type":"debug","z":"a5270bf39d2b1e5f","g":"e90afc02c540d6bf","name":"List services by filters","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":860,"y":2140,"wires":[]},{"id":"171b661d899461a7","type":"inject","z":"a5270bf39d2b1e5f","g":"e90afc02c540d6bf","name":"List services by filters","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"List services by filters","x":180,"y":2140,"wires":[["8363ee16734aa229"]]},{"id":"8363ee16734aa229","type":"function","z":"a5270bf39d2b1e5f","g":"e90afc02c540d6bf","name":"Authorization","func":"let accessToken = global.get('accessToken');\n\nmsg.headers = {};\n//msg.headers['Authorization'] = 'Bearer xxx';\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":370,"y":2140,"wires":[["e507970da3ab090e"]]},{"id":"a9f089bb889079ba","type":"inject","z":"a5270bf39d2b1e5f","g":"ad10637843808906","name":"List products by filters","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"List products by filters","x":200,"y":1000,"wires":[["cf6a8a293a3416f0"]]},{"id":"cf6a8a293a3416f0","type":"function","z":"a5270bf39d2b1e5f","g":"ad10637843808906","name":"Authorization","func":"let accessToken = global.get('accessToken');\n\nmsg.headers = {};\n//msg.headers['Authorization'] = 'Bearer xxx';\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":390,"y":1000,"wires":[["859a498192a464e6"]]},{"id":"00b57c33cfb11cbb","type":"function","z":"a5270bf39d2b1e5f","g":"e90afc02c540d6bf","name":"Authorization","func":"let accessToken = global.get('accessToken');\n\nmsg.headers = {};\n//msg.headers['Authorization'] = 'Bearer xxx';\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":370,"y":2200,"wires":[["8668d2144ef6f1c7"]]},{"id":"a562bd5b29300458","type":"inject","z":"a5270bf39d2b1e5f","g":"e90afc02c540d6bf","name":"List sellers","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"List sellers","x":220,"y":2200,"wires":[["00b57c33cfb11cbb"]]},{"id":"e431d47ac20af172","type":"http request","z":"a5270bf39d2b1e5f","g":"3b12e437c83e0daf","name":"Get sales totals by filter","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://api.contaazul.com/v1/sales/totals","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":610,"y":1780,"wires":[["05e86e4e8d3d1d2e"]]},{"id":"bf22b8e71c4d831a","type":"debug","z":"a5270bf39d2b1e5f","g":"3b12e437c83e0daf","name":"Get sales totals by filter","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1330,"y":1780,"wires":[]},{"id":"af4549b50d1d821d","type":"function","z":"a5270bf39d2b1e5f","g":"3b12e437c83e0daf","name":"Authorization","func":"let accessToken = global.get('accessToken');\n\nmsg.headers = {};\n//msg.headers['Authorization'] = 'Bearer xxx';\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":410,"y":1780,"wires":[["e431d47ac20af172"]]},{"id":"f725e856f8536fa5","type":"inject","z":"a5270bf39d2b1e5f","g":"3b12e437c83e0daf","name":"Get sales totals by filter","props":[{"p":"topic","vt":"str"}],"repeat":"3600","crontab":"","once":false,"onceDelay":0.1,"topic":"Get sales totals by filter","x":210,"y":1780,"wires":[["af4549b50d1d821d"]]},{"id":"7c80bb99fb8dd6cf","type":"inject","z":"a5270bf39d2b1e5f","g":"520c4afdd2a2c58c","name":"List sales","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"List sales","x":200,"y":1280,"wires":[["9e853932e5246287"]]},{"id":"9e853932e5246287","type":"function","z":"a5270bf39d2b1e5f","g":"520c4afdd2a2c58c","name":"Authorization","func":"let accessToken = global.get('accessToken');\n\nmsg.headers = {};\n//msg.headers['Authorization'] = 'Bearer xxx';\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":410,"y":1280,"wires":[["bb85a7678e125257"]]},{"id":"b43dde4d98c875f2","type":"http request","z":"a5270bf39d2b1e5f","g":"6096fe5c52cfd343","name":"List customers by filters","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://api.contaazul.com/v1/customers?size=999","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":570,"y":2000,"wires":[["8ef7304f87a2b516"]]},{"id":"e94038d695093f33","type":"debug","z":"a5270bf39d2b1e5f","g":"6096fe5c52cfd343","name":"List customers by filters","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1310,"y":2000,"wires":[]},{"id":"af723a6dc70c8d0c","type":"function","z":"a5270bf39d2b1e5f","g":"6096fe5c52cfd343","name":"Authorization","func":"let accessToken = global.get('accessToken');\n\nmsg.headers = {};\n//msg.headers['Authorization'] = 'Bearer xxx';\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":370,"y":2000,"wires":[["b43dde4d98c875f2"]]},{"id":"d437ac64422b7229","type":"inject","z":"a5270bf39d2b1e5f","g":"6096fe5c52cfd343","name":"List customers by filters","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"List customers by filters","x":180,"y":2000,"wires":[["af723a6dc70c8d0c"]]},{"id":"7fd9165a4da698af","type":"http request","z":"a5270bf39d2b1e5f","g":"e90afc02c540d6bf","name":"Get current user plans","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://api.contaazul.com/v1/plans/current","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":580,"y":2260,"wires":[["9d8a234b6c840cec"]]},{"id":"9d8a234b6c840cec","type":"debug","z":"a5270bf39d2b1e5f","g":"e90afc02c540d6bf","name":"Get current user plans","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":860,"y":2260,"wires":[]},{"id":"f1b30d04c9b97d4a","type":"function","z":"a5270bf39d2b1e5f","g":"e90afc02c540d6bf","name":"Authorization","func":"let accessToken = global.get('accessToken');\n\nmsg.headers = {};\n//msg.headers['Authorization'] = 'Bearer xxx';\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":370,"y":2260,"wires":[["7fd9165a4da698af"]]},{"id":"72686b373891ff9a","type":"inject","z":"a5270bf39d2b1e5f","g":"e90afc02c540d6bf","name":"Get current user plans","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"Get current user plans","x":180,"y":2260,"wires":[["f1b30d04c9b97d4a"]]},{"id":"85400eee0244b9bf","type":"delay","z":"a5270bf39d2b1e5f","g":"520c4afdd2a2c58c","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1130,"y":1240,"wires":[["dbc564b793ab2147","8394a30dc9e26b4a","7bdb4f61e6364d06"]]},{"id":"3dfc0881926e24b1","type":"inject","z":"a5270bf39d2b1e5f","g":"fdb14db95ecc5489","name":"Get sale by id","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"Get sale by id","x":170,"y":1620,"wires":[["9dc031fb3dd47809"]]},{"id":"9dc031fb3dd47809","type":"change","z":"a5270bf39d2b1e5f","g":"fdb14db95ecc5489","name":"","rules":[{"t":"set","p":"payload.id","pt":"msg","to":"d063ccd5-1e5f-4dc7-9409-15f4e8a15bd6","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":1620,"wires":[["ec24e2f9a38a9c56"]]},{"id":"71b447e4ec057c50","type":"inject","z":"a5270bf39d2b1e5f","g":"d4955d968e26a214","name":"List sale items by filters","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"List sale items by filters","x":200,"y":1480,"wires":[["e5b6127830cd9203"]]},{"id":"e5b6127830cd9203","type":"change","z":"a5270bf39d2b1e5f","g":"d4955d968e26a214","name":"","rules":[{"t":"set","p":"payload.id","pt":"msg","to":"d063ccd5-1e5f-4dc7-9409-15f4e8a15bd6","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":1480,"wires":[["8394a30dc9e26b4a"]]},{"id":"690fdab22117e084","type":"GSheet","z":"a5270bf39d2b1e5f","g":"8eb6a30e696f032d","creds":"f131e02fdc178416","method":"append","action":"","sheet":"xxx","cells":"product_categories!A:Z","flatten":false,"name":"product_categories","x":1590,"y":760,"wires":[[]]},{"id":"04393361ea052f4e","type":"function","z":"a5270bf39d2b1e5f","g":"8eb6a30e696f032d","name":"GSHEET - product_categories","func":"var id = msg.payload.id;\nvar name = msg.payload.name;\n\nmsg.payload = [id, name]\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1350,"y":760,"wires":[["690fdab22117e084"]]},{"id":"8859ca37fde68cd8","type":"split","z":"a5270bf39d2b1e5f","g":"8eb6a30e696f032d","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":970,"y":760,"wires":[["6e99bacf77e40947"]]},{"id":"8632dc1f7cae2e36","type":"split","z":"a5270bf39d2b1e5f","g":"ad10637843808906","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":970,"y":960,"wires":[["4b96b4f4e88fa774"]]},{"id":"96f25beefd9f4ad8","type":"function","z":"a5270bf39d2b1e5f","g":"ad10637843808906","name":"GSHEET - List products by filters","func":"var id = msg.payload.id || \"\";\nvar name = msg.payload.name || \"\";\nvar value = msg.payload.value || \"\";\nvar cost = msg.payload.cost || \"\";\nvar code = msg.payload.code || \"\";\nvar barcode = msg.payload.barcode || \"\";\nvar available_stock = msg.payload.available_stock || \"\";\nvar ncm_code = msg.payload.ncm_code || \"\";\nvar cest_code = msg.payload.cest_code || \"\";\nvar net_weight = msg.payload.net_weight || \"\";\nvar gross_weight = msg.payload.gross_weight || \"\";\nvar category_id = msg.payload.category.id || \"\";\nvar category_name = msg.payload.category.name || \"\";\nvar unit_measure = msg.payload.unit_measure || \"\";\nvar suppliers_id = msg.payload.suppliers.id || \"\";\nvar suppliers_name = msg.payload.suppliers.name || \"\";\n\nmsg.payload = [id, name, value, cost, code, barcode, available_stock, ncm_code, cest_code, net_weight, gross_weight, category_id, category_name, unit_measure, suppliers_id, suppliers_name]\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1360,"y":960,"wires":[["2b4d93a7377daeb3"]]},{"id":"2b4d93a7377daeb3","type":"GSheet","z":"a5270bf39d2b1e5f","g":"ad10637843808906","creds":"f131e02fdc178416","method":"append","action":"","sheet":"xxx","cells":"products!A:P","flatten":false,"name":"products","x":1600,"y":960,"wires":[[]]},{"id":"4b96b4f4e88fa774","type":"delay","z":"a5270bf39d2b1e5f","g":"ad10637843808906","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1120,"y":960,"wires":[["96f25beefd9f4ad8"]]},{"id":"6e99bacf77e40947","type":"delay","z":"a5270bf39d2b1e5f","g":"8eb6a30e696f032d","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1120,"y":760,"wires":[["04393361ea052f4e"]]},{"id":"6d1cc2dfd3f1a263","type":"switch","z":"a5270bf39d2b1e5f","g":"ad10637843808906","name":"statusCode 200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":780,"y":1000,"wires":[["8632dc1f7cae2e36","2456fb26facc2e13"],["7f682d4dd3a7350e"]]},{"id":"2456fb26facc2e13","type":"debug","z":"a5270bf39d2b1e5f","g":"ad10637843808906","name":"List products by filters (code 200)","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1060,"y":1020,"wires":[]},{"id":"288faaaba62e9a21","type":"switch","z":"a5270bf39d2b1e5f","g":"520c4afdd2a2c58c","name":"statusCode 200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":800,"y":1280,"wires":[["559f581f0b47ea55"],["42652ca971069b48"]]},{"id":"42652ca971069b48","type":"debug","z":"a5270bf39d2b1e5f","g":"520c4afdd2a2c58c","name":"List sales by filters (otherwise)","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1050,"y":1320,"wires":[]},{"id":"7bdb4f61e6364d06","type":"function","z":"a5270bf39d2b1e5f","g":"520c4afdd2a2c58c","name":"GSHEET - List sales by filters","func":"var id = msg.payload.id || \"\";\nvar ca_id = msg.payload.ca_id || \"\";\nvar number = msg.payload.number || \"\";\nvar emission = msg.payload.emission || \"\";\nvar status = msg.payload.status || \"\";\nvar scheduled = msg.payload.scheduled || \"\";\nvar customer_id = msg.payload.customer.id || \"\";\nvar customer_name = msg.payload.customer.name || \"\";\nvar discount = msg.payload.discount || \"\";\nvar product_discount = msg.payload.product_discount || \"\";\nvar service_discount = msg.payload.service_discount || \"\";\nvar payment_type = msg.payload.payment.type || \"\";\nvar payment_method = msg.payload.payment.method || \"\";\nvar payment_terms = msg.payload.payment_terms || \"\";\nvar notes = msg.payload.notes || \"\";\nvar shipping_cost = msg.payload.shipping_cost || \"\";\nvar shipping_forecast = msg.payload.id || \"\";\nvar total = msg.payload.total || \"\";\nvar proposal_date = msg.payload.proposal_date || \"\";\nvar expiration = msg.payload.expiration || \"\";\nvar introduction = msg.payload.introduction || \"\";\nvar shipping_forecast = msg.payload.shipping_forecast || \"\";\nvar category_id = msg.payload.category_id || \"\";\n\nmsg.payload = [\n    id,\n    ca_id,\n    number,\n    emission,\n    status,\n    scheduled,\n    customer_id,\n    customer_name,\n    discount,\n    product_discount,\n    service_discount,\n    payment_type,\n    payment_method,\n    payment_terms,\n    notes,\n    shipping_cost,\n    shipping_forecast,\n    total,\n    proposal_date,\n    expiration,\n    introduction,\n    shipping_forecast,\n    category_id\n    ]\n    \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1370,"y":1240,"wires":[["09f28a6bb15a86f2"]]},{"id":"09f28a6bb15a86f2","type":"GSheet","z":"a5270bf39d2b1e5f","g":"520c4afdd2a2c58c","creds":"f131e02fdc178416","method":"append","action":"","sheet":"xxx","cells":"sales!A:Z","flatten":false,"name":"sales","x":1610,"y":1240,"wires":[[]]},{"id":"aa7d344c640480bd","type":"function","z":"a5270bf39d2b1e5f","g":"520c4afdd2a2c58c","name":"List sales by filters","func":"//const date = new Date();\n//let day = date.getDate();\n//let month = date.getMonth() + 1;\n//let year = date.getFullYear();\n\n// This arrangement can be altered based on how we want the date's format to appear.\n//let currentDate = `${year}-${month}-${day}`;\nlet currentDate = new Date().toJSON().slice(0, 10);\n\nvar emission_start = currentDate;\nvar emission_end = currentDate;\n\nlet accessToken = global.get('accessToken');\n\nmsg.headers = {};\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\nmsg.url = \"https://api.contaazul.com/v1/sales?emission_start=\" + emission_start + \"&emission_end=\" + emission_end;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":1340,"wires":[["e2c59302d572a28d"]]},{"id":"e2c59302d572a28d","type":"http request","z":"a5270bf39d2b1e5f","g":"520c4afdd2a2c58c","name":"msg.url","method":"GET","ret":"obj","paytoqs":"query","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":660,"y":1340,"wires":[["288faaaba62e9a21"]]},{"id":"db8917699fd33413","type":"inject","z":"a5270bf39d2b1e5f","g":"520c4afdd2a2c58c","name":"List sales by filters date","props":[{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":false,"onceDelay":0.1,"topic":"List sales by filters date","x":210,"y":1340,"wires":[["aa7d344c640480bd"]]},{"id":"2c35938c1ab9765d","type":"switch","z":"a5270bf39d2b1e5f","g":"8eb6a30e696f032d","name":"statusCode 200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":800,"y":820,"wires":[["8859ca37fde68cd8","523bdef02e031da3"],[]]},{"id":"05e86e4e8d3d1d2e","type":"switch","z":"a5270bf39d2b1e5f","g":"3b12e437c83e0daf","name":"statusCode 200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":820,"y":1780,"wires":[["40265c08de68bbd9"],["36617a0d11f502d9"]]},{"id":"72ea348eb03bafbb","type":"delay","z":"a5270bf39d2b1e5f","g":"3b12e437c83e0daf","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1130,"y":1740,"wires":[["1cf8e60b301c5103","bf22b8e71c4d831a"]]},{"id":"1cf8e60b301c5103","type":"function","z":"a5270bf39d2b1e5f","g":"3b12e437c83e0daf","name":"GSHEET - Get sales totals by filter","func":"var date = new Date().toISOString();\nvar pending = msg.payload.PENDING.total || \"\";\nvar proposal_accepted = msg.payload.PROPOSAL_ACCEPTED.total || \"\";\nvar committed = msg.payload.COMMITTED.total || \"\";\nvar proposal = msg.payload.PROPOSAL.total || \"\";\nvar total = msg.payload.TOTAL.total || \"\";\n\nmsg.payload = [\n    date,\n    pending,\n    committed,\n    proposal,\n    proposal_accepted,\n    total\n    ]\n    \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1360,"y":1740,"wires":[["5c8d657e91f0bf57"]]},{"id":"5c8d657e91f0bf57","type":"GSheet","z":"a5270bf39d2b1e5f","g":"3b12e437c83e0daf","creds":"f131e02fdc178416","method":"append","action":"","sheet":"xxx","cells":"sales_totais!A:Z","flatten":false,"name":"sales_totais","x":1590,"y":1740,"wires":[[]]},{"id":"40265c08de68bbd9","type":"split","z":"a5270bf39d2b1e5f","g":"3b12e437c83e0daf","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":990,"y":1740,"wires":[["72ea348eb03bafbb"]]},{"id":"8ef7304f87a2b516","type":"switch","z":"a5270bf39d2b1e5f","g":"6096fe5c52cfd343","name":"statusCode 200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":780,"y":2000,"wires":[["837c90f110656909"],["9bde48f6bc610288"]]},{"id":"837c90f110656909","type":"split","z":"a5270bf39d2b1e5f","g":"6096fe5c52cfd343","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":950,"y":1960,"wires":[["0649b31b191683d2"]]},{"id":"0649b31b191683d2","type":"delay","z":"a5270bf39d2b1e5f","g":"6096fe5c52cfd343","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1100,"y":1960,"wires":[["8aafeac1723a951f","e94038d695093f33"]]},{"id":"8aafeac1723a951f","type":"function","z":"a5270bf39d2b1e5f","g":"6096fe5c52cfd343","name":"GSHEET - List customers by filters","func":"var id = msg.payload.id || \"\";\nvar name = msg.payload.name || \"\";\nvar company_name = msg.payload.company_name || \"\";\nvar email = msg.payload.email || \"\";\nvar business_phone = msg.payload.business_phone || \"\";\nvar mobile_phone = msg.payload.mobile_phone || \"\";\nvar person_type = msg.payload.person_type || \"\";\nvar document = msg.payload.document || \"\";\nvar identity_document = msg.payload.identity_document || \"\";\nvar state_registration_number = msg.payload.state_registration_number || \"\";\nvar state_registration_type = msg.payload.state_registration_type || \"\";\nvar city_registration_number = msg.payload.city_registration_number || \"\";\nvar date_of_birth = msg.payload.date_of_birth || \"\";\nvar notes = msg.payload.notes || \"\";\nvar created_at = msg.payload.created_at || \"\";\n\n\nmsg.payload = [\n    id,\n    name,\n    company_name,\n    email,\n    business_phone,\n    mobile_phone,\n    person_type,\n    document,\n    identity_document,\n    state_registration_number,\n    state_registration_type,\n    city_registration_number,\n    date_of_birth,\n    notes,\n    created_at\n    ]\n    \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1340,"y":1960,"wires":[["e926df5e9fdd5f13"]]},{"id":"e926df5e9fdd5f13","type":"GSheet","z":"a5270bf39d2b1e5f","g":"6096fe5c52cfd343","creds":"f131e02fdc178416","method":"append","action":"","sheet":"xxx","cells":"customers!A:Z","flatten":false,"name":"customers","x":1570,"y":1960,"wires":[[]]},{"id":"9bde48f6bc610288","type":"debug","z":"a5270bf39d2b1e5f","g":"6096fe5c52cfd343","name":"List customers by filters (otherwise)","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1040,"y":2040,"wires":[]},{"id":"36617a0d11f502d9","type":"debug","z":"a5270bf39d2b1e5f","g":"3b12e437c83e0daf","name":"Get sales totals by filter (otherwise)","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1080,"y":1820,"wires":[]},{"id":"e68697b67f6f0aa1","type":"switch","z":"a5270bf39d2b1e5f","g":"d4955d968e26a214","name":"statusCode 200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1020,"y":1480,"wires":[["ac1058c7e9d5117f"],[]]},{"id":"44f4dc20024c4528","type":"delay","z":"a5270bf39d2b1e5f","g":"d4955d968e26a214","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1380,"y":1440,"wires":[["3576871ba80bd4c5","b6a3304892da3876"]]},{"id":"3576871ba80bd4c5","type":"function","z":"a5270bf39d2b1e5f","g":"d4955d968e26a214","name":"GSHEET - List sale items by filters","func":"var id_sale = msg.contaazul || \"\";\nvar description = msg.payload.description || \"\";\nvar quantity = msg.payload.quantity || \"\";\nvar item_id = msg.payload.item.id || \"\";\nvar item_name = msg.payload.item.name || \"\";\nvar item_value = msg.payload.item.value || \"\";\nvar item_cost = msg.payload.item.cost || \"\";\nvar itemType = msg.payload.itemType || \"\";\nvar value = msg.payload.item.value || \"\";\nvar item_id = msg.payload.item.id || \"\";\n\n\nmsg.payload = [\n    id_sale,\n    description,\n    quantity,\n    item_id,\n    item_name,\n    item_value,\n    item_cost,\n    itemType,\n    value,\n    item_id\n    ]\n    \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1620,"y":1440,"wires":[["7f14a77456407be8"]]},{"id":"ac1058c7e9d5117f","type":"split","z":"a5270bf39d2b1e5f","g":"d4955d968e26a214","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1230,"y":1440,"wires":[["44f4dc20024c4528"]]},{"id":"7f14a77456407be8","type":"GSheet","z":"a5270bf39d2b1e5f","g":"d4955d968e26a214","creds":"f131e02fdc178416","method":"append","action":"","sheet":"xxx","cells":"sales_items!A:Z","flatten":false,"name":"sales_items","x":1830,"y":1440,"wires":[[]]},{"id":"ccc79a9b87589a0d","type":"http request","z":"a5270bf39d2b1e5f","g":"fdb14db95ecc5489","name":"msg.url","method":"GET","ret":"obj","paytoqs":"query","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":720,"y":1620,"wires":[["56d7c30edea5a455"]]},{"id":"56d7c30edea5a455","type":"switch","z":"a5270bf39d2b1e5f","g":"fdb14db95ecc5489","name":"statusCode 200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":880,"y":1620,"wires":[["d88f4d039f040eac"],[]]},{"id":"d88f4d039f040eac","type":"delay","z":"a5270bf39d2b1e5f","g":"fdb14db95ecc5489","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1100,"y":1600,"wires":[["6db64c6ff1f76750","8394a30dc9e26b4a"]]},{"id":"6db64c6ff1f76750","type":"function","z":"a5270bf39d2b1e5f","g":"fdb14db95ecc5489","name":"GSHEET - List sales by filters","func":"var id = msg.payload.id || \"\";\nvar ca_id = msg.payload.ca_id || \"\";\nvar number = msg.payload.number || \"\";\nvar emission = msg.payload.emission || \"\";\nvar status = msg.payload.status || \"\";\nvar scheduled = msg.payload.scheduled || \"\";\nvar customer_id = msg.payload.customer.id || \"\";\nvar customer_name = msg.payload.customer.name || \"\";\nvar discount = msg.payload.discount || \"\";\nvar product_discount = msg.payload.product_discount || \"\";\nvar service_discount = msg.payload.service_discount || \"\";\nvar payment_type = msg.payload.payment.type || \"\";\nvar payment_method = msg.payload.payment.method || \"\";\nvar payment_terms = msg.payload.payment_terms || \"\";\nvar notes = msg.payload.notes || \"\";\nvar shipping_cost = msg.payload.shipping_cost || \"\";\nvar shipping_forecast = msg.payload.id || \"\";\nvar total = msg.payload.total || \"\";\nvar proposal_date = msg.payload.proposal_date || \"\";\nvar expiration = msg.payload.expiration || \"\";\nvar introduction = msg.payload.introduction || \"\";\nvar shipping_forecast = msg.payload.shipping_forecast || \"\";\nvar category_id = msg.payload.category_id || \"\";\n\nmsg.payload = [\n    id,\n    ca_id,\n    number,\n    emission,\n    status,\n    scheduled,\n    customer_id,\n    customer_name,\n    discount,\n    product_discount,\n    service_discount,\n    payment_type,\n    payment_method,\n    payment_terms,\n    notes,\n    shipping_cost,\n    shipping_forecast,\n    total,\n    proposal_date,\n    expiration,\n    introduction,\n    shipping_forecast,\n    category_id\n    ]\n    \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1330,"y":1600,"wires":[["6497d0e79437e766"]]},{"id":"6497d0e79437e766","type":"GSheet","z":"a5270bf39d2b1e5f","g":"fdb14db95ecc5489","creds":"f131e02fdc178416","method":"append","action":"","sheet":"xxx","cells":"sales!A:Z","flatten":false,"name":"sales","x":1530,"y":1600,"wires":[[]]},{"id":"10d7fda56335549d","type":"oauth2","z":"a5270bf39d2b1e5f","g":"466b68bd101cc969","name":"","container":"oauth2Response","grant_type":"authorization_code","access_token_url":" https://api.contaazul.com/oauth2/token","authorization_endpoint":"https://api.contaazul.com/auth/authorize","redirect_uri":"/oauth2/redirect_uri","open_authentication":"","username":"","password":"","client_id":"QwkQtN5hQVHWVfpJDr7J1pamiWjvFDeo","client_secret":"Sra1MkjDU18SdsO5GTOz6hlTnMvthWM0","scope":"sales","client_credentials_in_body":false,"rejectUnauthorized":true,"headers":{},"x":370,"y":140,"wires":[["ceee711fb518653f","d820ad4eae640b0c"]]},{"id":"4030c52c.c2c29c","type":"inject","z":"a5270bf39d2b1e5f","g":"7e1a2f9059f99060","name":"Refresh Token","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":170,"y":320,"wires":[["31727a2c.05a026"]]},{"id":"31727a2c.05a026","type":"function","z":"a5270bf39d2b1e5f","g":"7e1a2f9059f99060","name":"SETTING REQUEST","func":"var REFRESH_TOKEN = global.get('refreshToken');\nvar ACCESS_TOKEN = global.get('accessToken');\n\nmsg.method = \"POST\"\nmsg.url = `https://api.contaazul.com/oauth2/token?grant_type=refresh_token&refresh_token=${REFRESH_TOKEN}`\nmsg.headers = {}\nmsg.headers[\"content-type\"] = \"application/json\"\nmsg.headers[\"Authorization\"] = `Bearer ${ACCESS_TOKEN}`;\n\n// var teach = teach\n// var loop = loop\n// msg.payload = [{\n//     \"mode\":teach,\n//     \"loop\":1\n// }]\nreturn msg","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":420,"y":320,"wires":[["64d9243f.b7be7c"]]},{"id":"64d9243f.b7be7c","type":"http request","z":"a5270bf39d2b1e5f","g":"7e1a2f9059f99060","name":"HTTP-REQUEST","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":770,"y":320,"wires":[["3b67977c.a53c08"]]},{"id":"3b67977c.a53c08","type":"debug","z":"a5270bf39d2b1e5f","g":"7e1a2f9059f99060","name":"","active":true,"tosidebar":true,"console":true,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1090,"y":320,"wires":[]},{"id":"fa297a2263ccab64","type":"debug","z":"ee01ea9dc7f8444d","g":"c11eb7aff843bd09","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1150,"y":120,"wires":[]},{"id":"b09fcda36b29337e","type":"oauth2","z":"ee01ea9dc7f8444d","g":"c11eb7aff843bd09","name":"Client Credentials","container":"oauth2Response","grant_type":"client_credentials","access_token_url":"http://localhost:3000/oauth/token ","username":"pedroet","password":"","client_id":"confidentialApplication","client_secret":"topSecret","scope":"*","rejectUnauthorized":true,"headers":{},"x":710,"y":100,"wires":[["92a15df57cfde3ad"]]},{"id":"68ce0e033979d11d","type":"inject","z":"ee01ea9dc7f8444d","g":"c11eb7aff843bd09","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":100,"wires":[["b09fcda36b29337e"]]},{"id":"6adbb00a164f0d30","type":"inject","z":"ee01ea9dc7f8444d","g":"dbf002e7839fdaf4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":300,"wires":[["5eedef6eb8215636"]]},{"id":"5eedef6eb8215636","type":"function","z":"ee01ea9dc7f8444d","g":"dbf002e7839fdaf4","name":"Refresh Token","func":"let refreshToken = global.get('refreshToken');\n\nmsg.oauth2Request = { \n    \"access_token_url\": \"http://localhost:3000/oauth/token\",\n    \"credentials\": {\n        \"grant_type\": \"refresh_token\",\n        \"client_id\": \"application\",\n        \"client_secret\": \"secret\",\n        \"scope\": \"*\",\n        \"refresh_token\": refreshToken   \n    },\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":420,"y":300,"wires":[["0dbd3192fc8e6d8f"]]},{"id":"bbb398a4c6b6581d","type":"oauth2","z":"ee01ea9dc7f8444d","g":"dbf002e7839fdaf4","name":"Set by msg.oauth2Request","container":"oauth2Response","grant_type":"set_by_credentials","access_token_url":"http://localhost:3000/oauth/token ","username":"pedroet","password":"","client_id":"confidentialApplication","client_secret":"topSecret","scope":"*","rejectUnauthorized":true,"headers":{},"x":720,"y":300,"wires":[["1f9670457ea0fdeb"]]},{"id":"5f5889fc9873830c","type":"function","z":"ee01ea9dc7f8444d","g":"dbf002e7839fdaf4","name":"Password","func":"msg.oauth2Request = { \n    \"access_token_url\": \"http://localhost:3000/oauth/token\",\n    \"credentials\": {\n        \"grant_type\": \"password\",\n        \"client_id\": \"application\",\n        \"client_secret\": \"secret\",\n        \"scope\": \"*\",\n        \"username\": \"pedroetb\",\n        \"password\": \"password\"   \n    },\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":440,"y":260,"wires":[["0dbd3192fc8e6d8f"]]},{"id":"aa78cee9cf6b05a4","type":"debug","z":"ee01ea9dc7f8444d","g":"dbf002e7839fdaf4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1150,"y":300,"wires":[]},{"id":"e92113c4c92e02b9","type":"inject","z":"ee01ea9dc7f8444d","g":"dbf002e7839fdaf4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":260,"wires":[["5f5889fc9873830c"]]},{"id":"1f9670457ea0fdeb","type":"function","z":"ee01ea9dc7f8444d","g":"dbf002e7839fdaf4","name":"Set refreshToken","func":"if (msg.oauth2Response.refreshToken) {\n    global.set('refreshToken',msg.oauth2Response.refreshToken);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":970,"y":300,"wires":[["aa78cee9cf6b05a4"]]},{"id":"457c466345b3c830","type":"oauth2","z":"ee01ea9dc7f8444d","g":"c11eb7aff843bd09","name":"Password","container":"oauth2Response","grant_type":"password","access_token_url":"http://localhost:3000/oauth/token ","username":"pedroetb","password":"password","client_id":"application","client_secret":"secret","scope":"*","rejectUnauthorized":true,"headers":{},"x":740,"y":160,"wires":[["92a15df57cfde3ad"]]},{"id":"be9f8d3e5126b0aa","type":"inject","z":"ee01ea9dc7f8444d","g":"c11eb7aff843bd09","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":160,"wires":[["457c466345b3c830"]]},{"id":"00bcb23670663c56","type":"function","z":"ee01ea9dc7f8444d","g":"dbf002e7839fdaf4","name":"Client Credentials","func":"msg.oauth2Request = { \n    \"access_token_url\": \"http://localhost:3000/oauth/token\",\n    \"credentials\": {\n        \"grant_type\": \"client_credentials\",\n        \"client_id\": \"confidentialApplication\",\n        \"client_secret\": \"topSecret\",\n        \"scope\": \"*\"\n    },\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":410,"y":340,"wires":[["0dbd3192fc8e6d8f"]]},{"id":"da4c05becf924c6a","type":"inject","z":"ee01ea9dc7f8444d","g":"dbf002e7839fdaf4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":340,"wires":[["00bcb23670663c56"]]},{"id":"41140191adba1afc","type":"function","z":"ee01ea9dc7f8444d","g":"c11eb7aff843bd09","name":"Set accessToken","func":"if (msg.oauth2Response.accessToken) {\n    global.set('accessToken', msg.oauth2Response.accessToken);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":970,"y":120,"wires":[["fa297a2263ccab64"]]},{"id":"2e5abb9821a329c6","type":"debug","z":"5c9759ef3159a97a","g":"51404f5021ed7fca","name":"Set Global Token","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":810,"y":80,"wires":[]},{"id":"3b4f8e8b37bd7b95","type":"oauth2","z":"5c9759ef3159a97a","g":"51404f5021ed7fca","name":"Client Credentials","container":"oauth2Response","grant_type":"authorization_code","access_token_url":"https://api.contaazul.com/oauth2/token","authorization_endpoint":"https://api.contaazul.com/auth/authorize","open_authentication":"","username":"lcaloi","password":"","client_id":"client_id","client_secret":"client_secret","scope":"sales","client_credentials_in_body":true,"rejectUnauthorized":true,"headers":{},"x":410,"y":60,"wires":[["04911ba0231eee37","55f197ed00ab8cef"]]},{"id":"894dc2ef962f6a0c","type":"inject","z":"5c9759ef3159a97a","g":"51404f5021ed7fca","name":"Client Credentials","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":190,"y":80,"wires":[["8105c17d77dcf7e7"]]},{"id":"1dcf1dfdf1af4aa2","type":"http request","z":"5c9759ef3159a97a","g":"35588b75d7d50afa","name":"List product categories","method":"GET","ret":"obj","paytoqs":"query","url":"https://api.contaazul.com/v1/product-categories","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":590,"y":720,"wires":[["e9dc48db000bfe67"]]},{"id":"04911ba0231eee37","type":"function","z":"5c9759ef3159a97a","g":"51404f5021ed7fca","name":"Set Global Token","func":"global.set('refreshToken', msg.oauth2Response.refresh_token);\nglobal.set('accessToken', msg.oauth2Response.access_token);\nglobal.set('tokenType', msg.oauth2Response.token_type);\nglobal.set('expiresIn', msg.oauth2Response.expires_in);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":610,"y":80,"wires":[["2e5abb9821a329c6"]]},{"id":"4b95cdba611c7ecc","type":"function","z":"5c9759ef3159a97a","g":"35588b75d7d50afa","name":"Authorization","func":"let accessToken = global.get('accessToken');\n\nmsg.headers = {};\n//msg.headers['Authorization'] = 'Bearer XXXX';\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":390,"y":720,"wires":[["1dcf1dfdf1af4aa2"]]},{"id":"22fc844e4abc01ef","type":"inject","z":"5c9759ef3159a97a","g":"35588b75d7d50afa","name":"List product categories","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"List product categories","x":200,"y":720,"wires":[["4b95cdba611c7ecc"]]},{"id":"88ca1d0a07edc082","type":"http request","z":"5c9759ef3159a97a","g":"3b9e704044803c6a","name":"List products by filters","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://api.contaazul.com/v1/products?size=999","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":580,"y":900,"wires":[["6549481bf4a5f244"]]},{"id":"c7d6de386335dc90","type":"http request","z":"5c9759ef3159a97a","g":"99fae81d7a094d03","name":"List sales by filters","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://api.contaazul.com/v1/sales?emission_start=2023-03-27&emission_end=2023-03-27","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":590,"y":1180,"wires":[["e0bb1fa57aff0d1d"]]},{"id":"7c718a1f2929762b","type":"http request","z":"5c9759ef3159a97a","g":"2b3d518cab3c19a8","name":"List sellers","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://api.contaazul.com/v1/sales/sellers","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":550,"y":2200,"wires":[["1cbf3a9ed6c20988"]]},{"id":"91436a6d7b36eb04","type":"inject","z":"5c9759ef3159a97a","g":"bd07876c8e425d9d","name":"Refresh Token","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3300","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":220,"wires":[["a56d3f31e9e72b71"]]},{"id":"a56d3f31e9e72b71","type":"function","z":"5c9759ef3159a97a","g":"bd07876c8e425d9d","name":"Refresh Token","func":"let refreshToken = global.get('refreshToken');\n\nmsg.oauth2Request = { \n    \"access_token_url\": \"https://api.contaazul.com/oauth2/token\",\n    \"credentials\": {\n        \"grant_type\": \"refresh_token\",\n        \"client_id\": \"pDcX0lJRsUfWovh5kAOHdILX8W53bcnE\",\n        \"client_secret\": \"tcRJQdy2s9bKoJAFJRSJh6ycHuBY2emo\",\n        \"scope\": \"sales\",\n        \"refresh_token\": refreshToken   \n    },\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":220,"wires":[["d4ad2e5511305738"]]},{"id":"d4ad2e5511305738","type":"oauth2","z":"5c9759ef3159a97a","g":"bd07876c8e425d9d","name":"Set by msg.oauth2Request","container":"oauth2Response","grant_type":"set_by_credentials","access_token_url":"http://localhost:3000/oauth/token ","username":"pedroet","password":"","client_id":"confidentialApplication","client_secret":"topSecret","scope":"*","headers":{},"x":660,"y":220,"wires":[["979cb5cc50bd910e"]]},{"id":"979cb5cc50bd910e","type":"function","z":"5c9759ef3159a97a","g":"bd07876c8e425d9d","name":"Set refreshToken","func":"if (msg.oauth2Response.refreshToken) {\n    global.set('refreshToken',msg.oauth2Response.refreshToken);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":890,"y":220,"wires":[["41867e59d52a4194"]]},{"id":"41867e59d52a4194","type":"debug","z":"5c9759ef3159a97a","g":"bd07876c8e425d9d","name":"Refresh Token","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1080,"y":220,"wires":[]},{"id":"55f197ed00ab8cef","type":"debug","z":"5c9759ef3159a97a","g":"51404f5021ed7fca","name":"Client Credentials","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":610,"y":120,"wires":[]},{"id":"1cbf3a9ed6c20988","type":"debug","z":"5c9759ef3159a97a","g":"2b3d518cab3c19a8","name":"List sellers","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":830,"y":2200,"wires":[]},{"id":"f9fa3a590217202e","type":"debug","z":"5c9759ef3159a97a","g":"99fae81d7a094d03","name":"List sales by filters","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1350,"y":1200,"wires":[]},{"id":"bd7baf5218eb49f8","type":"debug","z":"5c9759ef3159a97a","g":"3b9e704044803c6a","name":"List products by filters (otherwise)","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1060,"y":980,"wires":[]},{"id":"19a4cabc78515277","type":"debug","z":"5c9759ef3159a97a","g":"35588b75d7d50afa","name":"List product categories","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1030,"y":720,"wires":[]},{"id":"8a181a7c94f10639","type":"debug","z":"5c9759ef3159a97a","g":"a8ac9c83a7b77bf0","name":"sales-items","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1390,"y":1400,"wires":[]},{"id":"c316e349cd742259","type":"function","z":"5c9759ef3159a97a","g":"a8ac9c83a7b77bf0","name":"List sale items by filters","func":"let id = msg.payload.id;\nlet accessToken = global.get('accessToken');\n\nmsg.headers = {};\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\nmsg.url = \"https://api.contaazul.com/v1/sales/\" + id + \"/items\";\nmsg.contaazul = id;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":670,"y":1380,"wires":[["06c2e22ef01b56df"]]},{"id":"050e2e72ba37fc78","type":"split","z":"5c9759ef3159a97a","g":"99fae81d7a094d03","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":990,"y":1140,"wires":[["3092da4bd85a147d"]]},{"id":"b247935249683177","type":"change","z":"5c9759ef3159a97a","g":"f1dbdf37623a6927","name":"accessToken","rules":[{"t":"set","p":"payload","pt":"msg","to":"accessToken","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":320,"wires":[["35cc77879440c98c"]]},{"id":"35cc77879440c98c","type":"debug","z":"5c9759ef3159a97a","g":"f1dbdf37623a6927","name":"accessToken","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":670,"y":320,"wires":[]},{"id":"aaff5253f1fade5b","type":"inject","z":"5c9759ef3159a97a","g":"f1dbdf37623a6927","name":"Valida Variaveis Globais","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":200,"y":400,"wires":[["b247935249683177","6b8b1a021eed6da5","e8a495a3b5df0ca4","d05028084a3d104a"]]},{"id":"6b8b1a021eed6da5","type":"change","z":"5c9759ef3159a97a","g":"f1dbdf37623a6927","name":"refreshToken","rules":[{"t":"set","p":"payload","pt":"msg","to":"refreshToken","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":380,"wires":[["c14b14bebd07ec44"]]},{"id":"c14b14bebd07ec44","type":"debug","z":"5c9759ef3159a97a","g":"f1dbdf37623a6927","name":"refreshToken","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":670,"y":380,"wires":[]},{"id":"e8a495a3b5df0ca4","type":"change","z":"5c9759ef3159a97a","g":"f1dbdf37623a6927","name":"tokenType","rules":[{"t":"set","p":"payload","pt":"msg","to":"tokenType","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":440,"wires":[["96eb5d6d55ee0977"]]},{"id":"96eb5d6d55ee0977","type":"debug","z":"5c9759ef3159a97a","g":"f1dbdf37623a6927","name":"tokenType","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":670,"y":440,"wires":[]},{"id":"d05028084a3d104a","type":"change","z":"5c9759ef3159a97a","g":"f1dbdf37623a6927","name":"expiresIn","rules":[{"t":"set","p":"payload","pt":"msg","to":"expiresIn","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":500,"wires":[["fed0f6203cbff7dd"]]},{"id":"fed0f6203cbff7dd","type":"debug","z":"5c9759ef3159a97a","g":"f1dbdf37623a6927","name":"expiresIn","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":660,"y":500,"wires":[]},{"id":"06c2e22ef01b56df","type":"http request","z":"5c9759ef3159a97a","g":"a8ac9c83a7b77bf0","name":"msg.url","method":"GET","ret":"obj","paytoqs":"query","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":860,"y":1380,"wires":[["09fbd32cd28448d0"]]},{"id":"fde5fd829b827d3b","type":"function","z":"5c9759ef3159a97a","g":"7a261fa71959f9de","name":"Get sale by id","func":"let id = msg.payload.id;\nlet accessToken = global.get('accessToken');\n\nmsg.headers = {};\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\nmsg.url = \"https://api.contaazul.com/v1/sales/\" + id;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":560,"y":1520,"wires":[["06da29a6553dc345"]]},{"id":"e66b94590d2247cd","type":"http request","z":"5c9759ef3159a97a","g":"2b3d518cab3c19a8","name":"List services by filters","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://api.contaazul.com/v1/services","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":580,"y":2140,"wires":[["9f23868617c4734a"]]},{"id":"9f23868617c4734a","type":"debug","z":"5c9759ef3159a97a","g":"2b3d518cab3c19a8","name":"List services by filters","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":860,"y":2140,"wires":[]},{"id":"151247aeb12dbd79","type":"inject","z":"5c9759ef3159a97a","g":"2b3d518cab3c19a8","name":"List services by filters","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"List services by filters","x":180,"y":2140,"wires":[["ac81aad291b9dfa5"]]},{"id":"ac81aad291b9dfa5","type":"function","z":"5c9759ef3159a97a","g":"2b3d518cab3c19a8","name":"Authorization","func":"let accessToken = global.get('accessToken');\n\nmsg.headers = {};\n//msg.headers['Authorization'] = 'Bearer xxx';\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":370,"y":2140,"wires":[["e66b94590d2247cd"]]},{"id":"b1371c0ff1bfdee4","type":"inject","z":"5c9759ef3159a97a","g":"3b9e704044803c6a","name":"List products by filters","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"List products by filters","x":200,"y":900,"wires":[["8b012fb4ed07cea3"]]},{"id":"8b012fb4ed07cea3","type":"function","z":"5c9759ef3159a97a","g":"3b9e704044803c6a","name":"Authorization","func":"let accessToken = global.get('accessToken');\n\nmsg.headers = {};\n//msg.headers['Authorization'] = 'Bearer xxx';\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":390,"y":900,"wires":[["88ca1d0a07edc082"]]},{"id":"9cf710228a5b5188","type":"function","z":"5c9759ef3159a97a","g":"2b3d518cab3c19a8","name":"Authorization","func":"let accessToken = global.get('accessToken');\n\nmsg.headers = {};\n//msg.headers['Authorization'] = 'Bearer xxx';\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":370,"y":2200,"wires":[["7c718a1f2929762b"]]},{"id":"cf318bc7530bdf7c","type":"inject","z":"5c9759ef3159a97a","g":"2b3d518cab3c19a8","name":"List sellers","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"List sellers","x":220,"y":2200,"wires":[["9cf710228a5b5188"]]},{"id":"58d49901950d08f6","type":"http request","z":"5c9759ef3159a97a","g":"ea8a0fa9679b81d2","name":"Get sales totals by filter","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://api.contaazul.com/v1/sales/totals","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":610,"y":1680,"wires":[["a6495e2c7558b8c2"]]},{"id":"fa9c8e28505c82a9","type":"debug","z":"5c9759ef3159a97a","g":"ea8a0fa9679b81d2","name":"Get sales totals by filter","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1330,"y":1680,"wires":[]},{"id":"36fdb7968167bc14","type":"function","z":"5c9759ef3159a97a","g":"ea8a0fa9679b81d2","name":"Authorization","func":"let accessToken = global.get('accessToken');\n\nmsg.headers = {};\n//msg.headers['Authorization'] = 'Bearer xxx';\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":410,"y":1680,"wires":[["58d49901950d08f6"]]},{"id":"22ce6f6bd61b88d7","type":"inject","z":"5c9759ef3159a97a","g":"ea8a0fa9679b81d2","name":"Get sales totals by filter","props":[{"p":"topic","vt":"str"}],"repeat":"3600","crontab":"","once":false,"onceDelay":0.1,"topic":"Get sales totals by filter","x":210,"y":1680,"wires":[["36fdb7968167bc14"]]},{"id":"8ed74c2f06e92c4e","type":"inject","z":"5c9759ef3159a97a","g":"99fae81d7a094d03","name":"List sales","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"List sales","x":200,"y":1180,"wires":[["9739957ad5885163"]]},{"id":"9739957ad5885163","type":"function","z":"5c9759ef3159a97a","g":"99fae81d7a094d03","name":"Authorization","func":"let accessToken = global.get('accessToken');\n\nmsg.headers = {};\n//msg.headers['Authorization'] = 'Bearer xxx';\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":410,"y":1180,"wires":[["c7d6de386335dc90"]]},{"id":"5461287b8732fb07","type":"http request","z":"5c9759ef3159a97a","g":"41aa784187311a07","name":"List customers by filters","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://api.contaazul.com/v1/customers?size=999","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":570,"y":1980,"wires":[["5f619e3680f763af"]]},{"id":"340a1eace5a4e4e2","type":"debug","z":"5c9759ef3159a97a","g":"41aa784187311a07","name":"List customers by filters","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1310,"y":1980,"wires":[]},{"id":"bad94711051ba5e3","type":"function","z":"5c9759ef3159a97a","g":"41aa784187311a07","name":"Authorization","func":"let accessToken = global.get('accessToken');\n\nmsg.headers = {};\n//msg.headers['Authorization'] = 'Bearer xxx';\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":370,"y":1980,"wires":[["5461287b8732fb07"]]},{"id":"9391f1454c274c40","type":"inject","z":"5c9759ef3159a97a","g":"41aa784187311a07","name":"List customers by filters","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"List customers by filters","x":180,"y":1980,"wires":[["bad94711051ba5e3"]]},{"id":"2894df20c5f31f08","type":"http request","z":"5c9759ef3159a97a","g":"2b3d518cab3c19a8","name":"Get current user plans","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://api.contaazul.com/v1/plans/current","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":580,"y":2260,"wires":[["2a3ffad572ec0b9f"]]},{"id":"2a3ffad572ec0b9f","type":"debug","z":"5c9759ef3159a97a","g":"2b3d518cab3c19a8","name":"Get current user plans","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":860,"y":2260,"wires":[]},{"id":"6eeba9f7935a61c9","type":"function","z":"5c9759ef3159a97a","g":"2b3d518cab3c19a8","name":"Authorization","func":"let accessToken = global.get('accessToken');\n\nmsg.headers = {};\n//msg.headers['Authorization'] = 'Bearer xxx';\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":370,"y":2260,"wires":[["2894df20c5f31f08"]]},{"id":"7d509b300234fb53","type":"inject","z":"5c9759ef3159a97a","g":"2b3d518cab3c19a8","name":"Get current user plans","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"Get current user plans","x":180,"y":2260,"wires":[["6eeba9f7935a61c9"]]},{"id":"3092da4bd85a147d","type":"delay","z":"5c9759ef3159a97a","g":"99fae81d7a094d03","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1130,"y":1140,"wires":[["f9fa3a590217202e","c316e349cd742259","f5b1c680f82c4ee6"]]},{"id":"fea10929382cdf5b","type":"inject","z":"5c9759ef3159a97a","g":"7a261fa71959f9de","name":"Get sale by id","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"Get sale by id","x":170,"y":1520,"wires":[["ec2e39922e42fd55"]]},{"id":"ec2e39922e42fd55","type":"change","z":"5c9759ef3159a97a","g":"7a261fa71959f9de","name":"","rules":[{"t":"set","p":"payload.id","pt":"msg","to":"d063ccd5-1e5f-4dc7-9409-15f4e8a15bd6","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":1520,"wires":[["fde5fd829b827d3b"]]},{"id":"da58e4a719dd7334","type":"inject","z":"5c9759ef3159a97a","g":"a8ac9c83a7b77bf0","name":"List sale items by filters","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"List sale items by filters","x":200,"y":1380,"wires":[["7d6588d955f2d3d8"]]},{"id":"7d6588d955f2d3d8","type":"change","z":"5c9759ef3159a97a","g":"a8ac9c83a7b77bf0","name":"","rules":[{"t":"set","p":"payload.id","pt":"msg","to":"d063ccd5-1e5f-4dc7-9409-15f4e8a15bd6","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":1380,"wires":[["c316e349cd742259"]]},{"id":"961a51c12ae3005f","type":"GSheet","z":"5c9759ef3159a97a","g":"35588b75d7d50afa","creds":"f131e02fdc178416","method":"append","action":"","sheet":"xxx","cells":"product_categories!A:Z","flatten":false,"name":"product_categories","x":1590,"y":660,"wires":[[]]},{"id":"07703155e48b860d","type":"function","z":"5c9759ef3159a97a","g":"35588b75d7d50afa","name":"GSHEET - product_categories","func":"var id = msg.payload.id;\nvar name = msg.payload.name;\n\nmsg.payload = [id, name]\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1350,"y":660,"wires":[["961a51c12ae3005f"]]},{"id":"d2f55a4a34d1fc76","type":"split","z":"5c9759ef3159a97a","g":"35588b75d7d50afa","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":970,"y":660,"wires":[["cbeb25d8c2fb3866"]]},{"id":"728dcd9a98ae0381","type":"split","z":"5c9759ef3159a97a","g":"3b9e704044803c6a","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":970,"y":860,"wires":[["5929942a20b21e97"]]},{"id":"ea4d233de31bcc0d","type":"function","z":"5c9759ef3159a97a","g":"3b9e704044803c6a","name":"GSHEET - List products by filters","func":"var id = msg.payload.id || \"\";\nvar name = msg.payload.name || \"\";\nvar value = msg.payload.value || \"\";\nvar cost = msg.payload.cost || \"\";\nvar code = msg.payload.code || \"\";\nvar barcode = msg.payload.barcode || \"\";\nvar available_stock = msg.payload.available_stock || \"\";\nvar ncm_code = msg.payload.ncm_code || \"\";\nvar cest_code = msg.payload.cest_code || \"\";\nvar net_weight = msg.payload.net_weight || \"\";\nvar gross_weight = msg.payload.gross_weight || \"\";\nvar category_id = msg.payload.category.id || \"\";\nvar category_name = msg.payload.category.name || \"\";\nvar unit_measure = msg.payload.unit_measure || \"\";\nvar suppliers_id = msg.payload.suppliers.id || \"\";\nvar suppliers_name = msg.payload.suppliers.name || \"\";\n\nmsg.payload = [id, name, value, cost, code, barcode, available_stock, ncm_code, cest_code, net_weight, gross_weight, category_id, category_name, unit_measure, suppliers_id, suppliers_name]\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1360,"y":860,"wires":[["3667c87482f6b13c"]]},{"id":"3667c87482f6b13c","type":"GSheet","z":"5c9759ef3159a97a","g":"3b9e704044803c6a","creds":"f131e02fdc178416","method":"append","action":"","sheet":"xxx","cells":"products!A:P","flatten":false,"name":"products","x":1600,"y":860,"wires":[[]]},{"id":"5929942a20b21e97","type":"delay","z":"5c9759ef3159a97a","g":"3b9e704044803c6a","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1120,"y":860,"wires":[["ea4d233de31bcc0d"]]},{"id":"cbeb25d8c2fb3866","type":"delay","z":"5c9759ef3159a97a","g":"35588b75d7d50afa","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1120,"y":660,"wires":[["07703155e48b860d"]]},{"id":"6549481bf4a5f244","type":"switch","z":"5c9759ef3159a97a","g":"3b9e704044803c6a","name":"statusCode 200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":780,"y":900,"wires":[["728dcd9a98ae0381","7411304d57de6ad2"],["bd7baf5218eb49f8"]]},{"id":"7411304d57de6ad2","type":"debug","z":"5c9759ef3159a97a","g":"3b9e704044803c6a","name":"List products by filters (code 200)","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1060,"y":920,"wires":[]},{"id":"e0bb1fa57aff0d1d","type":"switch","z":"5c9759ef3159a97a","g":"99fae81d7a094d03","name":"statusCode 200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":800,"y":1180,"wires":[["050e2e72ba37fc78"],["23255cdefad65576"]]},{"id":"23255cdefad65576","type":"debug","z":"5c9759ef3159a97a","g":"99fae81d7a094d03","name":"List sales by filters (otherwise)","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1050,"y":1220,"wires":[]},{"id":"f5b1c680f82c4ee6","type":"function","z":"5c9759ef3159a97a","g":"99fae81d7a094d03","name":"GSHEET - List sales by filters","func":"var id = msg.payload.id || \"\";\nvar ca_id = msg.payload.ca_id || \"\";\nvar number = msg.payload.number || \"\";\nvar emission = msg.payload.emission || \"\";\nvar status = msg.payload.status || \"\";\nvar scheduled = msg.payload.scheduled || \"\";\nvar customer_id = msg.payload.customer.id || \"\";\nvar customer_name = msg.payload.customer.name || \"\";\nvar discount = msg.payload.discount || \"\";\nvar product_discount = msg.payload.product_discount || \"\";\nvar service_discount = msg.payload.service_discount || \"\";\nvar payment_type = msg.payload.payment.type || \"\";\nvar payment_method = msg.payload.payment.method || \"\";\nvar payment_terms = msg.payload.payment_terms || \"\";\nvar notes = msg.payload.notes || \"\";\nvar shipping_cost = msg.payload.shipping_cost || \"\";\nvar shipping_forecast = msg.payload.id || \"\";\nvar total = msg.payload.total || \"\";\nvar proposal_date = msg.payload.proposal_date || \"\";\nvar expiration = msg.payload.expiration || \"\";\nvar introduction = msg.payload.introduction || \"\";\nvar shipping_forecast = msg.payload.shipping_forecast || \"\";\nvar category_id = msg.payload.category_id || \"\";\n\nmsg.payload = [\n    id,\n    ca_id,\n    number,\n    emission,\n    status,\n    scheduled,\n    customer_id,\n    customer_name,\n    discount,\n    product_discount,\n    service_discount,\n    payment_type,\n    payment_method,\n    payment_terms,\n    notes,\n    shipping_cost,\n    shipping_forecast,\n    total,\n    proposal_date,\n    expiration,\n    introduction,\n    shipping_forecast,\n    category_id\n    ]\n    \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1370,"y":1140,"wires":[["d4741f4f29552e23"]]},{"id":"d4741f4f29552e23","type":"GSheet","z":"5c9759ef3159a97a","g":"99fae81d7a094d03","creds":"f131e02fdc178416","method":"append","action":"","sheet":"xxx","cells":"sales!A:Z","flatten":false,"name":"sales","x":1610,"y":1140,"wires":[[]]},{"id":"35d736e805bee757","type":"function","z":"5c9759ef3159a97a","g":"99fae81d7a094d03","name":"List sales by filters","func":"//const date = new Date();\n//let day = date.getDate();\n//let month = date.getMonth() + 1;\n//let year = date.getFullYear();\n\n// This arrangement can be altered based on how we want the date's format to appear.\n//let currentDate = `${year}-${month}-${day}`;\nlet currentDate = new Date().toJSON().slice(0, 10);\n\nvar emission_start = currentDate;\nvar emission_end = currentDate;\n\nlet accessToken = global.get('accessToken');\n\nmsg.headers = {};\nmsg.headers['Authorization'] = 'Bearer ' + accessToken;\nmsg.url = \"https://api.contaazul.com/v1/sales?emission_start=\" + emission_start + \"&emission_end=\" + emission_end;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":1240,"wires":[["2f2bfe9eacc38c83"]]},{"id":"2f2bfe9eacc38c83","type":"http request","z":"5c9759ef3159a97a","g":"99fae81d7a094d03","name":"msg.url","method":"GET","ret":"obj","paytoqs":"query","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":660,"y":1240,"wires":[["e0bb1fa57aff0d1d"]]},{"id":"d815e97ec30e2840","type":"inject","z":"5c9759ef3159a97a","g":"99fae81d7a094d03","name":"List sales by filters date","props":[{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":false,"onceDelay":0.1,"topic":"List sales by filters date","x":210,"y":1240,"wires":[["35d736e805bee757"]]},{"id":"e9dc48db000bfe67","type":"switch","z":"5c9759ef3159a97a","g":"35588b75d7d50afa","name":"statusCode 200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":800,"y":720,"wires":[["d2f55a4a34d1fc76","19a4cabc78515277"],[]]},{"id":"a6495e2c7558b8c2","type":"switch","z":"5c9759ef3159a97a","g":"ea8a0fa9679b81d2","name":"statusCode 200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":820,"y":1680,"wires":[["035b26e486df209c"],["f5c0c9efd0efeaca"]]},{"id":"62a3d2117b39ee68","type":"delay","z":"5c9759ef3159a97a","g":"ea8a0fa9679b81d2","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1130,"y":1640,"wires":[["eb5b0d016a514a87","fa9c8e28505c82a9"]]},{"id":"eb5b0d016a514a87","type":"function","z":"5c9759ef3159a97a","g":"ea8a0fa9679b81d2","name":"GSHEET - Get sales totals by filter","func":"var date = new Date().toISOString();\nvar pending = msg.payload.PENDING.total || \"\";\nvar proposal_accepted = msg.payload.PROPOSAL_ACCEPTED.total || \"\";\nvar committed = msg.payload.COMMITTED.total || \"\";\nvar proposal = msg.payload.PROPOSAL.total || \"\";\nvar total = msg.payload.TOTAL.total || \"\";\n\nmsg.payload = [\n    date,\n    pending,\n    committed,\n    proposal,\n    proposal_accepted,\n    total\n    ]\n    \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1360,"y":1640,"wires":[["b5ef4d8767a8ce52"]]},{"id":"b5ef4d8767a8ce52","type":"GSheet","z":"5c9759ef3159a97a","g":"ea8a0fa9679b81d2","creds":"f131e02fdc178416","method":"append","action":"","sheet":"xxx","cells":"sales_totais!A:Z","flatten":false,"name":"sales_totais","x":1590,"y":1640,"wires":[[]]},{"id":"035b26e486df209c","type":"split","z":"5c9759ef3159a97a","g":"ea8a0fa9679b81d2","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":990,"y":1640,"wires":[["62a3d2117b39ee68"]]},{"id":"5f619e3680f763af","type":"switch","z":"5c9759ef3159a97a","g":"41aa784187311a07","name":"statusCode 200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":780,"y":1980,"wires":[["f7d87502783b12ca"],["70651ac9c17f487e"]]},{"id":"f7d87502783b12ca","type":"split","z":"5c9759ef3159a97a","g":"41aa784187311a07","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":950,"y":1940,"wires":[["2e415f8420c1a579"]]},{"id":"2e415f8420c1a579","type":"delay","z":"5c9759ef3159a97a","g":"41aa784187311a07","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1100,"y":1940,"wires":[["7857032bb2b21f4e","340a1eace5a4e4e2"]]},{"id":"7857032bb2b21f4e","type":"function","z":"5c9759ef3159a97a","g":"41aa784187311a07","name":"GSHEET - List customers by filters","func":"var id = msg.payload.id || \"\";\nvar name = msg.payload.name || \"\";\nvar company_name = msg.payload.company_name || \"\";\nvar email = msg.payload.email || \"\";\nvar business_phone = msg.payload.business_phone || \"\";\nvar mobile_phone = msg.payload.mobile_phone || \"\";\nvar person_type = msg.payload.person_type || \"\";\nvar document = msg.payload.document || \"\";\nvar identity_document = msg.payload.identity_document || \"\";\nvar state_registration_number = msg.payload.state_registration_number || \"\";\nvar state_registration_type = msg.payload.state_registration_type || \"\";\nvar city_registration_number = msg.payload.city_registration_number || \"\";\nvar date_of_birth = msg.payload.date_of_birth || \"\";\nvar notes = msg.payload.notes || \"\";\nvar created_at = msg.payload.created_at || \"\";\n\n\nmsg.payload = [\n    id,\n    name,\n    company_name,\n    email,\n    business_phone,\n    mobile_phone,\n    person_type,\n    document,\n    identity_document,\n    state_registration_number,\n    state_registration_type,\n    city_registration_number,\n    date_of_birth,\n    notes,\n    created_at\n    ]\n    \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1340,"y":1940,"wires":[["690f9621cd962e9d"]]},{"id":"690f9621cd962e9d","type":"GSheet","z":"5c9759ef3159a97a","g":"41aa784187311a07","creds":"f131e02fdc178416","method":"append","action":"","sheet":"xxx","cells":"customers!A:Z","flatten":false,"name":"customers","x":1570,"y":1940,"wires":[[]]},{"id":"70651ac9c17f487e","type":"debug","z":"5c9759ef3159a97a","g":"41aa784187311a07","name":"List customers by filters (otherwise)","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1040,"y":2020,"wires":[]},{"id":"f5c0c9efd0efeaca","type":"debug","z":"5c9759ef3159a97a","g":"ea8a0fa9679b81d2","name":"Get sales totals by filter (otherwise)","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1080,"y":1720,"wires":[]},{"id":"09fbd32cd28448d0","type":"switch","z":"5c9759ef3159a97a","g":"a8ac9c83a7b77bf0","name":"statusCode 200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1020,"y":1380,"wires":[["a2c763f2768a2cf0"],[]]},{"id":"7220291f1f854695","type":"delay","z":"5c9759ef3159a97a","g":"a8ac9c83a7b77bf0","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1380,"y":1340,"wires":[["15f7895c5704f726","8a181a7c94f10639"]]},{"id":"15f7895c5704f726","type":"function","z":"5c9759ef3159a97a","g":"a8ac9c83a7b77bf0","name":"GSHEET - List sale items by filters","func":"var id_sale = msg.contaazul || \"\";\nvar description = msg.payload.description || \"\";\nvar quantity = msg.payload.quantity || \"\";\nvar item_id = msg.payload.item.id || \"\";\nvar item_name = msg.payload.item.name || \"\";\nvar item_value = msg.payload.item.value || \"\";\nvar item_cost = msg.payload.item.cost || \"\";\nvar itemType = msg.payload.itemType || \"\";\nvar value = msg.payload.item.value || \"\";\nvar item_id = msg.payload.item.id || \"\";\n\n\nmsg.payload = [\n    id_sale,\n    description,\n    quantity,\n    item_id,\n    item_name,\n    item_value,\n    item_cost,\n    itemType,\n    value,\n    item_id\n    ]\n    \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1620,"y":1340,"wires":[["82c2ca737c66f4c1"]]},{"id":"a2c763f2768a2cf0","type":"split","z":"5c9759ef3159a97a","g":"a8ac9c83a7b77bf0","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1230,"y":1340,"wires":[["7220291f1f854695"]]},{"id":"82c2ca737c66f4c1","type":"GSheet","z":"5c9759ef3159a97a","g":"a8ac9c83a7b77bf0","creds":"f131e02fdc178416","method":"append","action":"","sheet":"xxx","cells":"sales_items!A:Z","flatten":false,"name":"sales_items","x":1830,"y":1340,"wires":[[]]},{"id":"06da29a6553dc345","type":"http request","z":"5c9759ef3159a97a","g":"7a261fa71959f9de","name":"msg.url","method":"GET","ret":"obj","paytoqs":"query","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":720,"y":1520,"wires":[["4f65ce046ea15683"]]},{"id":"4f65ce046ea15683","type":"switch","z":"5c9759ef3159a97a","g":"7a261fa71959f9de","name":"statusCode 200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":880,"y":1520,"wires":[["2ed1581d96c9c313"],[]]},{"id":"2ed1581d96c9c313","type":"delay","z":"5c9759ef3159a97a","g":"7a261fa71959f9de","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1100,"y":1500,"wires":[["62cdf19d62ebb032","c316e349cd742259"]]},{"id":"62cdf19d62ebb032","type":"function","z":"5c9759ef3159a97a","g":"7a261fa71959f9de","name":"GSHEET - List sales by filters","func":"var id = msg.payload.id || \"\";\nvar ca_id = msg.payload.ca_id || \"\";\nvar number = msg.payload.number || \"\";\nvar emission = msg.payload.emission || \"\";\nvar status = msg.payload.status || \"\";\nvar scheduled = msg.payload.scheduled || \"\";\nvar customer_id = msg.payload.customer.id || \"\";\nvar customer_name = msg.payload.customer.name || \"\";\nvar discount = msg.payload.discount || \"\";\nvar product_discount = msg.payload.product_discount || \"\";\nvar service_discount = msg.payload.service_discount || \"\";\nvar payment_type = msg.payload.payment.type || \"\";\nvar payment_method = msg.payload.payment.method || \"\";\nvar payment_terms = msg.payload.payment_terms || \"\";\nvar notes = msg.payload.notes || \"\";\nvar shipping_cost = msg.payload.shipping_cost || \"\";\nvar shipping_forecast = msg.payload.id || \"\";\nvar total = msg.payload.total || \"\";\nvar proposal_date = msg.payload.proposal_date || \"\";\nvar expiration = msg.payload.expiration || \"\";\nvar introduction = msg.payload.introduction || \"\";\nvar shipping_forecast = msg.payload.shipping_forecast || \"\";\nvar category_id = msg.payload.category_id || \"\";\n\nmsg.payload = [\n    id,\n    ca_id,\n    number,\n    emission,\n    status,\n    scheduled,\n    customer_id,\n    customer_name,\n    discount,\n    product_discount,\n    service_discount,\n    payment_type,\n    payment_method,\n    payment_terms,\n    notes,\n    shipping_cost,\n    shipping_forecast,\n    total,\n    proposal_date,\n    expiration,\n    introduction,\n    shipping_forecast,\n    category_id\n    ]\n    \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1330,"y":1500,"wires":[["192fcb289ca9f3bf"]]},{"id":"192fcb289ca9f3bf","type":"GSheet","z":"5c9759ef3159a97a","g":"7a261fa71959f9de","creds":"f131e02fdc178416","method":"append","action":"","sheet":"xxx","cells":"sales!A:Z","flatten":false,"name":"sales","x":1530,"y":1500,"wires":[[]]},{"id":"8105c17d77dcf7e7","type":"oauth2","z":"5c9759ef3159a97a","g":"51404f5021ed7fca","name":"","container":"oauth2Response","grant_type":"authorization_code","access_token_url":" https://api.contaazul.com/oauth2/token","authorization_endpoint":"https://api.contaazul.com/auth/authorize","redirect_uri":"/oauth2/redirect_uri","open_authentication":"","username":"","password":"","client_id":"QwkQtN5hQVHWVfpJDr7J1pamiWjvFDeo","client_secret":"Sra1MkjDU18SdsO5GTOz6hlTnMvthWM0","scope":"sales","client_credentials_in_body":false,"rejectUnauthorized":true,"headers":{},"x":370,"y":120,"wires":[["04911ba0231eee37","55f197ed00ab8cef"]]},{"id":"2b2fa87a3ebdd2b9","type":"oauth2","z":"487db9b6715b0e50","g":"9b8802ac7671fc6a","name":"OAuth2 - Conta Azul","container":"oauth2Response","grant_type":"authorization_code","access_token_url":" https://api.contaazul.com/oauth2/token","authorization_endpoint":"https://api.contaazul.com/auth/authorize","redirect_uri":"/oauth2/redirect_uri","open_authentication":"FiKnN7E7eSesMm7QmYQRDCOKHaWy4igr","username":"","password":"","client_id":"","client_secret":"","scope":"Product","proxy":"","senderr":false,"client_credentials_in_body":false,"rejectUnauthorized":false,"headers":{},"x":340,"y":80,"wires":[["657f72e1082f3e16"]]},{"id":"a2d2d1b9d446f1a8","type":"inject","z":"487db9b6715b0e50","g":"9b8802ac7671fc6a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":80,"wires":[["2b2fa87a3ebdd2b9"]]},{"id":"7925e8f35166a321","type":"debug","z":"487db9b6715b0e50","g":"9b8802ac7671fc6a","name":"debug","active":true,"tosidebar":true,"console":true,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":880,"y":120,"wires":[]},{"id":"657f72e1082f3e16","type":"function","z":"487db9b6715b0e50","g":"9b8802ac7671fc6a","name":"set ACCESS_TOKEN","func":"global.set('ACCESS_TOKEN', msg.oauth2Response.access_token);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":660,"y":80,"wires":[["7925e8f35166a321"]]},{"id":"90b407562de16c0f","type":"inject","z":"487db9b6715b0e50","g":"9b8802ac7671fc6a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":160,"wires":[["82b6e134785ca7de"]]},{"id":"c4e0873c88c773bc","type":"conta-azul","z":"487db9b6715b0e50","g":"9b8802ac7671fc6a","name":"","api":"Product","server":"","keepAuth":false,"alternServer":false,"operation":"list1","operationData":{"tags":["Product"],"summary":"List product categories","description":"","operationId":"list1","produces":["application/json"],"parameters":[{"name":"name","in":"query","description":"The name of the product category","required":false,"type":"string"},{"name":"page","in":"query","description":"The page of the list to be returned","required":false,"type":"string"},{"name":"size","in":"query","description":"The quantity of items in the page to be returned","required":false,"type":"string"}],"responses":{"200":{"description":"Product Categories found with the specified parameters","schema":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string","format":"uuid","example":"c7288c09-829d-48b9-aee2-4f744e380587","description":"The id of the product's category"},"name":{"type":"string","example":"Kitchen utensils","description":"The name of the product's category"}},"description":"A category that can be applied to a product","$$ref":"https://api.contaazul.com/schema#/definitions/ProductCategory"}}},"400":{"description":"Invalid search parameters. The possible reasons are : <ul><li>A invalid search parameter was provided</li><li>No search parameters were provided</li></ul>"},"401":{"description":"Unauthorized token - it may be due to an invalid token or no token provided"}},"__originalOperationId":"list","path":"/v1/product-categories"},"errorHandling":"Standard","internalErrors":{"readUrl":false},"parameters":[{"id":"namequery","name":"name","in":"query","required":false,"value":"","isActive":false,"type":"str","allowedTypes":["str","json","jsonata","msg","flow","global"],"description":"The name of the product category","schema":null,"keys":null,"showDescription":false},{"id":"pagequery","name":"page","in":"query","required":false,"value":"","isActive":false,"type":"str","allowedTypes":["str","json","jsonata","msg","flow","global"],"description":"The page of the list to be returned","schema":null,"keys":null,"showDescription":false},{"id":"sizequery","name":"size","in":"query","required":false,"value":"","isActive":false,"type":"str","allowedTypes":["str","json","jsonata","msg","flow","global"],"description":"The quantity of items in the page to be returned","schema":null,"keys":null,"showDescription":false}],"requestContentType":"application/json","responseContentType":"","showDescription":true,"devMode":false,"outputs":1,"x":610,"y":160,"wires":[["7925e8f35166a321"]]},{"id":"82b6e134785ca7de","type":"function","z":"487db9b6715b0e50","g":"9b8802ac7671fc6a","name":"get ACCESS_TOKEN","func":"msg.openApiToken = global.get('ACCESS_TOKEN');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":160,"wires":[["c4e0873c88c773bc"]]}]
```

## License
This repository and the code inside it is licensed under the MIT License. Read LICENSE for more information.

## Developers

If you want to modify something inside the conta-azul.html file, I recommend to use [SIR](https://gitlab.com/2WeltenChris/svelte-integration-red).

With help of SIR you can handle the conta-azul.svelte file in which the code is much cleaner and easier to handle.
